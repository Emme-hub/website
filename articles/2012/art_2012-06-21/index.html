<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2012/art_2012-06-21/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>Créer votre moteur d'itinéraires Open Source avec OSRM - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li class=active> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../art_2012-07-02/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../art_2012-06-06/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#creer-votre-moteur-ditineraires-open-source-avec-osrm>Créer votre moteur d'itinéraires Open Source avec OSRM</a></li> <li><a href=#open-source-routing-machine>Open Source Routing Machine</a></li> <li><a href=#installation-dosrm>Installation d'OSRM</a></li> <li><a href=#configuration-dosrm>Configuration d'OSRM</a></li> <li><a href=#visualisation-des-itineraires>Visualisation des itinéraires</a></li> <li><a href=#conclusion>Conclusion</a></li> <li><a href=#auteur>Auteur</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=creer-votre-moteur-ditineraires-open-source-avec-osrm>Créer votre moteur d'itinéraires Open Source avec OSRM<a class=headerlink href=#creer-votre-moteur-ditineraires-open-source-avec-osrm title="Permanent link">#</a></h1> <p>:calendar: Date de publication initiale : 21 juin 2012</p> <p><strong>Mots-clés :</strong> OpenStreetMap | Open Source | OSRM</p> <p>Souvent, quand je parle d'OpenStreetMap (OSM), on me répond : "ah oui c'est un peu comme Google Maps mais en libre". Bien que cela ne soit pas totalement faux, c'est réduire le projet OSM à sa simple utilisation comme fond de carte. Or les possibilités et les potentialités de celui-ci sont bien plus grandes. Mais, et je trouve cela dommage, il existe encore trop peu d'applications permettant une exploitation de ces données Open Source. Néanmoins, trop peu ne veut pas dire aucune. Preuve en est, je vous présenterai dans ce billet <a href=http://project-osrm.org/ >Open Source Routing Machine</a>, un moteur d'itinéraire Open Source. Fini le simple affichage de données sur un fond de carte, nous allons maintenant exploiter le plein potentiel de celles-ci !</p> <hr> <h4 id=open-source-routing-machine>Open Source Routing Machine<a class=headerlink href=#open-source-routing-machine title="Permanent link">#</a></h4> <p>Créé par <a href=http://algo2.iti.kit.edu/luxen.php>Dennis Luxen</a> de l'Institut Technologique de Karlsruhe, <a href=http://project-osrm.org/ >Open Source Routing Machine</a> (OSRM) est un moteur d'itinéraire Open Source utilisant les données d'<a href=https://www.openstreetmap.org/ >OpenStreetMap</a>. Écrit en C++, il est utilisable sur différentes plateformes (Linux, FreeBSD, Windows, Mac). Contrairement aux autres moteurs existants qui sont pour la plupart basés sur un algorithme de type A*, celui-ci implémente l’approche de contraction de hiérarchies de Geisberger <a href=#footnote1_d5l60yi title="Geisberger, R., Sanders, P., Schultes, D. and Delling, D. (2008). Contraction hierarchies : Faster and simpler hierarchical routing in road networks. Experimental Algorithms, pp. 319–333. (http://algo2.iti.kit.edu/schultes/hwy/contract.pdf)">1</a>. Je serai bien incapable de vous parler en détail de cet algorithme, mais si cela vous intéresse sachez que vous pouvez consulter la thèse de Gräbener dont l'un des paragraphes porte sur ce sujet <a href=#footnote2_sz6i7yr title="Gräbener, T. (2010) Calcul d'itinéraire multimodal et multiobjectif en milieu urbain, pp. 94. (http://dl.demotera.com/these_graebener.pdf)">2</a>.</p> <p>Bon c'est bien beau d'implémenter un autre algorithme, mais est-ce pour autant que celui-ci est plus rapide. En tout état de cause OUI ! La comparaison effectuée par <a href=http://neis-one.org/ >Pascal Neis</a> est sans équivoque. En effet, OSRM est 4 à 7 fois plus rapide que les moteur d'itinéraires de MapQuest et de CloudMade. Mieux encore, il se place même devant celui de Google, c'est vous dire.</p> <p><img alt src=http://neis-one.org/wp-content/uploads/2011/07/comparison_routing_times.png><br> <em>Source : <a href=http://neis-one.org/2011/07/comparison-routing/ >Neis One</a></em></p> <p>Enfin, pour alimenter un moteur d'itinéraires il vous faut des données. Là encore, les concepteurs du projet ont pensé à tout car OSRM est capable de lire directement les fichiers <a href=https://www.openstreetmap.org/ >OpenStreetMap</a>. Petit rappel si cela était nécessaire, mais OSM est un projet de cartographie libre vous permettant à la fois de contribuer mais aussi d'exploiter les données produites. C'est d'ailleurs ce que nous allons faire dans le cadre de ce billet. Passons donc à la partie technique et mettons en place notre propre serveur OSRM.</p> <h4 id=installation-dosrm>Installation d'OSRM<a class=headerlink href=#installation-dosrm title="Permanent link">#</a></h4> <p>La meilleure source d'informations est bien évidemment le <a href=https://github.com/DennisOSRM/Project-OSRM/wiki>Wiki du projet</a>. Dans le cadre de ce billet, nous relaterons les différentes étapes par lesquelles nous sommes passées afin d'illustrer plus concrètement la démarche. Cela vous permettra en tout cas de voir avec quelle simplicité cela a été réalisé.</p> <p>La première étape consiste à télécharger les <a href=https://github.com/DennisOSRM/Project-OSRM>sources du projet</a>. Pour cela, un simple <em>git clone</em> est suffisant. Maintenant, voyons voir les prérequis. En effet, OSRM s'appuie sur un certain nombre de bibliothèques. Lors de notre première installation sur une Ubtuntu 11.04, nous avions du compiler les librairies protobuf et boost pour des raisons de versions trop anciennes dans les dépôts. Depuis, une nouvelle installation sur une Ubtuntu 12.04 a résolu tout cela et il suffit simplement de faire un apt-get install en spécifiant les bibliothèques ci-dessous :</p> <p>sudo apt-get install build-essential git scons libprotoc-dev libprotobuf7 protobuf-compiler libprotobuf-dev libpng-dev libbz2-dev sudo apt-get install libstxxl-dev libstxxl-doc libstxxl1 libxml2-dev libzip-dev libboost-thread-dev libboost-system-dev libboost-regex-dev</p> <p>Afin de permettre un certain confort de lecture, nous avons séparé le téléchargement des bibliothèques en deux lignes. Mais vous pouvez bien évidemment spécifier le tout avec un seul <em>apt-get</em>. On laisse un peu le temps à la machine de tout télécharger et installer et nous avons quasiment terminé. En effet, il vous suffit maintenant de lancer la commande <em>scons</em> dans le répertoire d'OSRM et le projet se compilera automatiquement. Si vous fonctionnez sur un Debian ou une Ubuntu, il se peut, comme cela a été le cas pour nous, que la compilation retourne un message d'erreur. Pas de panique, c'est un <a href=https://github.com/DennisOSRM/Project-OSRM/issues/177>problème connu</a> et il suffit simplement de relancer la commande une seconde fois pour que tout fonctionne.</p> <p>Voilà, tout est quasiment terminé. Il reste maintenant à passer à la configuration et nous serons prêts à nous amuser.</p> <h4 id=configuration-dosrm>Configuration d'OSRM<a class=headerlink href=#configuration-dosrm title="Permanent link">#</a></h4> <p>Avant d'aborder concrètement la configuration d'OSRM il y a encore une petite chose à faire, la préparation des données. En effet, OSRM précalcule les itinéraires afin de proposer des performances optimales. Pour cela, deux étapes sont nécessaires. Tout d'abord, toujours dans le dossier contenant les sources d'OSRM, il faut lancer la commande <em>osrm-extract</em> avec en argument le chemin vers le fichier OSM. Sachez que OSRM est également capable de directement lire les fichiers au format bz2 ou pbf. mais revenons à notre extraction des données :</p> <p>./osrm-extract MonFichier.osm</p> <p>Une fois réalisé, vous obtiendrez alors trois autres fichiers dont l'extension est : MonFichier.osrm MonFichier.osrm.names et MonFichier.osrm.restrictions. Nous utiliserons deux d’entre eux lors de l'étape de création de la hiérarchie. Celle-ci permet au moteur de précalculer les itinéraires potentiels. Par défaut une configuration (ram, disk, etc.) est déjà pré-paramétrée. Néanmoins, en fonction de votre architecture informatique vous pouvez affiner ces paramètres. Pour le moment, faisons simple et gardons celle déjà proposée. Lançons donc la commande <em>osrm-prepare</em> en spécifiant cette fois en argument <em>MonFichier.osrm</em> et <em>MonFichier.osrm.restrictions</em> :</p> <p>./osrm-prepare MonFichier.osrm MonFichier.osrm.restrictions</p> <p>Vous devriez maintenant disposer de 5 nouveaux fichiers : <em>MonFichier.osrm.nodes</em>, <em>MonFichier.osrm.edges</em>, <em>MonFichier.osrm.ramIndex</em>, <em>MonFichier.osrm.fileIndex</em> et <em>MonFichier.osrm.hsgr</em>.</p> <p>Allé, encore quelques secondes et tout est quasiment terminé. Dernière étape, la configuration d'OSRM. Pour cela, tout se fait à partir du fichier server.ini. La structure de celui-ci est la suivante :</p> <p>Threads = 8 IP = 00.00.00.00 Port = 5000 hsgrData=MonFichier.osrm.hsgr nodesData=MonFichier.osrm.nodes edgesData=MonFichier.osrm.edges ramIndex=MonFichier.osrm.ramIndex fileIndex=MonFichier.osrm.fileIndex namesData=MonFichier.osrm.names timestamp=MonFichier.osrm.timestamp</p> <p>Là encore, rien d'insurmontable. Le seul paramètre qui n'est pas renseigné dans le wiki est le timestamp. Je n'ai pas compris à quoi il servait et aucun fichier de ce type n'est créé par OSRM. Néanmoins, j'ai ajouté la même information que les lignes précédentes et cela fonctionne. Ce fichier n'a pas l'air primordial !</p> <p>Maintenant que tout est configuré, lançons notre moteur d'itinéraires. Cela se fait grâce à la commande osrm-routed. Si tout est correct, les lignes suivantes devraient s'afficher :</p> <p>./osrm-routed [server] starting up engines, saved at Sat Jun 16 10:30:46 2012 [server] http 1.1 compression handled by zlib version 1.2.3.4 [info Server/DataStructures/QueryObjectsStorage.cpp:26] loading graph data [info Server/DataStructures/QueryObjectsStorage.cpp:33] Data checksum is 358366287 [info Server/DataStructures/QueryObjectsStorage.cpp:39] Loading Timestamp [info Server/DataStructures/QueryObjectsStorage.cpp:49] Loading auxiliary information [info Server/DataStructures/QueryObjectsStorage.cpp:57] Loading names index [info Server/DataStructures/QueryObjectsStorage.cpp:74] All query data structures loaded [handler] registering plugin hello [handler] registering plugin locate [handler] registering plugin nearest [handler] registering plugin timestamp [handler] registering plugin viaroute [server] running and waiting for requests</p> <p>Tadam ! Votre serveur est prêt et il n'attend plus que vos requêtes. Pour cela, tout se fait par le biais d'appels HTTP formatés. Différentes requêtes sont disponibles (locate, nearest et viaroute) et pour plus de détails je vous laisse le soin de consulter l'<a href=https://github.com/DennisOSRM/Project-OSRM/wiki/Server-api>API</a> ainsi que le billet écrit par Rodolphe Quiédeville.</p> <h4 id=visualisation-des-itineraires>Visualisation des itinéraires<a class=headerlink href=#visualisation-des-itineraires title="Permanent link">#</a></h4> <p>Par défaut, vous trouverez dans le fichier <em>Docs/WebFrontend</em> d'OSRM une interface basée sur OpenLayers <a href=http://neis-one.org/2011/05/gui-osrm/ >développée par Pascal Neis</a>. Bien que parfaitement fonctionnelle notre coup de coeur va sur celle développée par Dennis Schiefer dont les <a href=https://github.com/DennisOSRM/Project-OSRM-Web>sources</a> sont sur GitHub. Pourquoi celle-là ? Tout simplement parce que l'ergonomie est bien meilleure et qu'elle possède un plus grand nombre de fonctionnalités.</p> <p>Une fois les sources téléchargées et le dossier placé dans un endroit accessible par internet il suffit de configurer le projet. Pour cela, tout est centralisé dans le fichier <em>OSRM.config.js</em>. Le paramètre principal est <em>HOST_ROUTING_URL</em> qui indique l'adresse de votre serveur d'itinéraires. Ensuite, à vous de tout customiser comme vous le souhaitez.</p> <p>Bon visuellement qu'est-ce que cela donne ? Le plus simple pour cela est de faire un tour sur la <a href=http://map.project-osrm.org/ >démo</a> disponible en ligne. Amusez-vous à calculer quelques itinéraires, vous verrez comme cela est rapide. En plus, OSRM est même capable de prendre en compte les lignes de ferry (cf <a href=http://map.project-osrm.org/Gr>exemple</a>).</p> <p>Chez Géotribu nous avons également notre projet OSRM Home Made ! Tout d'abord parce que nous avions envie d'essayer et aussi car sur la zone qui nous intéressait (La Réunion) les données proposées dans la démo précédente sont assez vieilles (quoi que depuis, il semblerait qu'une mise jour a été réalisée). Quoi qu'il en soit, voilà le premier moteur d'itinéraires Open Source pour l'Ile de La Réunion :</p> <p><a href=http://geotribu.net/applications/OSRM_leaflet_974/main.html><img alt=OSRM974.png src=http://geotribu.net/sites/default/files/Tuto/img/OSM/OSRM/OSRM974.png></a></p> <h4 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">#</a></h4> <p>Nous arrivons au terme de cette courte introduction à OSRM. Au départ, ce projet nous avait immédiatement plu par la rapidité des calculs ainsi que par son utilisation d'OpenStreetMap. Ce sentiment s'est confirmé par la suite tant son installation ainsi que sa configuration sont simples. Bien qu'encore assez jeune, il pourrait néanmoins devenir une référence dans le domaine. A voir maintenant si de futurs développements sont programmés et surtout si les créateurs du projet arrivent à fédérer une communauté. En tout cas, c'est un beau boulot. Félicitations à toute l'équipe de l'Institut Technologique de Karlsruhe !</p> <ul> <li><a href=#footnoteref1_d5l60yi>1.</a> Geisberger, R., Sanders, P., Schultes, D. and Delling, D. (2008). Contraction hierarchies : Faster and simpler hierarchical routing in road networks. Experimental Algorithms, pp. 319–333. (<a href=http://algo2.iti.kit.edu/schultes/hwy/contract.pdf>http://algo2.iti.kit.edu/schultes/hwy/contract.pdf</a>)</li> <li><a href=#footnoteref2_sz6i7yr>2.</a> Gräbener, T. (2010) Calcul d'itinéraire multimodal et multiobjectif en milieu urbain, pp. 94. (<a href=http://dl.demotera.com/these_graebener.pdf>http://dl.demotera.com/these_graebener.pdf</a>)</li> </ul> <hr> <h2 id=auteur>Auteur<a class=headerlink href=#auteur title="Permanent link">#</a></h2> <p><img alt="Portait de Arnaud Vandecasteele" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/internal/contributeurs/avdc.jpg> <strong>Arnaud Vandecasteele</strong></p> <p>Fervent défenseur de l'Open Source, Arnaud s'est spécialisé dans le développement d'application cartographiques web. OpenLayers, PostGIS ou encore Django sont autant d'outils qu'il manipule au quotidien.<br> S'il n'est pas en face de son ordinateur, vous le retrouverez un GPS à la main en train de cartographier pour OpenStreetMap, de faire voler son drone ou sur un tatami !</p></div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>