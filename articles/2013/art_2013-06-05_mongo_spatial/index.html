<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2013/art_2013-06-05_mongo_spatial/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>Mongo Spatial - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li class=active> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../art_2013-06-13_itw_davidjonglez/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../art_2013-05-29/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#mongo-spatial>Mongo Spatial</a></li> <li><a href=#introduction>Introduction</a></li> <li><a href=#installation>Installation</a></li> <li><a href=#configurer-mongo>Configurer Mongo</a></li> <li><a href=#insertion-de-donnees-spatiales>Insertion de données spatiales</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=mongo-spatial>Mongo Spatial<a class=headerlink href=#mongo-spatial title="Permanent link">#</a></h1> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Ce contenu est une archive. Son contenu n'est sûrement plus très frais...</p> </div> <p>Tuto GeoTribu d'introduction à MongoDB pour l'information spatiale. Nécessite de légère base de <a href=http://fr.openclassrooms.com/informatique/cours/dynamisez-vos-sites-web-avec-javascript>Javascript</a>, rien de sorcier.</p> <p>Je recommande vivement l'utilisation de l'excellent editeur de code open source <a href=http://brackets.io/ >Brackets</a>.</p> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">#</a></h2> <p>Le but de ce tutorial est de découvrir via un exemple simple comment assembler une architecture de données spatiales avec mongodb, puis dans un second tutoriel, en y ajoutant node.js.</p> <p>Mongo et node sont deux technologies qui font beaucoup parler d'elles. Beaucoup s'y opposent arguant que <a href=http://sametmax.com/un-gros-troll-de-plus-sur-javacscript/ >javascript est une abération</a>, spécialement côté serveur. Revenir aussi sur 40 ans de maturation de SQL, simplement par effet de mode, serait pour certains une perte de temps. Ça se défend. De mon point de vue, je prends mon pieds avec ces outils et en participant au bouillaunement qui les entoure, notamment dans le domaine de la carto. Ça innove de partout. Malgrès quelques contraintes, Javascript apporte aussi une forme de simplicité et d'accessibilité. Si vous ne vous y êtes pas encore mis, les compétances que vous développerez en vous plongeant dans mongo et node vous serviront par la suite à mieux appréhender <a href=http://d3js.org/ >D3.js</a> et pourquoi pas <a href=http://threejs.org/ >Three.js</a>. La dynamique autour de javascript ne semble pas ralentir, bien au contraire.</p> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">#</a></h2> <p>Je ne vais pas m'étendre ici, pour node, rendez vous simplement sur <a href=http://nodejs.org/ title=nodejs.org>nodejs.org</a> et sélectionner votre OS. Si vous utilisez Ubuntu, vous pouvez ouvrir un terminal et entrer:</p> <div class=highlight><pre><span></span><code>sudo apt-get install python-software-properties
sudo add-apt-repository ppa:chris-lea/node.js
sudo apt-get update
sudo apt-get install nodejs
</code></pre></div> <p>Vous pouvez ensuite lancer un <code>node --version</code> pour vérifier que l'instalation s'est bien passée.</p> <p>Pour MongoDB, c'est la même chose, vous n'avez qu'à suivre le <a href=http://docs.mongodb.org/manual/installation/ title=docs.mongodb.org/manual/installation/ >Guide d'installation</a></p> <h2 id=configurer-mongo>Configurer Mongo<a class=headerlink href=#configurer-mongo title="Permanent link">#</a></h2> <p>Si vous avez suivi le guide mongo, votre serveur de base de données devrait être actif. Si la commande <code>mongo</code> retourne <code>Error: couldn't connect to server 127.0.0.1:27017</code>... c'est qu'il ne l'est pas. Rien de plus simple:</p> <div class=highlight><pre><span></span><code>mongod ## pour lancer mongodb
mongod --repair ## parfois utile après avoir fermé malencontreusement mongod...
</code></pre></div> <p>La première chose à faire est de créer une base de données. C'est extrèment simple. Toujours dans le terminal, lancer la commande <code>mongo</code> pour ouvrir une connection à la base de données par defaut "test":</p> <div class=highlight><pre><span></span><code>mongo
MongoDB shell version: 2.4.9 // Ceci est le résultat de la commande mongo.
connecting to: test
&gt;
</code></pre></div> <p>Vous remarquerez que le curseur a changé. A partir de maintenant, mongo n'acceptera plus que du javascript, mais extrèmemnt simple. Commençons par créer une base de données:</p> <div class=highlight><pre><span></span><code>use surfdb
switched to db surfdb // Ceci est le résultat de la commande use [dbname].
&gt;
</code></pre></div> <p>Fermer la connection en pressant <code>Ctrl + C</code>.</p> <p>La base de données est prete.</p> <h2 id=insertion-de-donnees-spatiales>Insertion de données spatiales<a class=headerlink href=#insertion-de-donnees-spatiales title="Permanent link">#</a></h2> <p>Passons à l'étape de l'insertion des données. De base, mongodb propose un outil pour importer les formats JSON, CSV or TSV. Même s'il gère une sorte de GEOJSON, l'objet <a href=http://geojson.org/geojson-spec.html#feature-collection-objects>FeatureCollection</a> pose encore problème. Rien de grâve car il suffit juste d'extrère l'array <code>features</code>:</p> <p>Au lieu d'utiliser ça:</p> <div class=highlight><pre><span></span><code>{
  &quot;type&quot;: &quot;FeatureCollection&quot;,
  &quot;features&quot;:
  [
    {
      &quot;type&quot;: &quot;Feature&quot;, &quot;id&quot;: 0, &quot;properties&quot;: {
        &quot;Name&quot;: &quot;Queensie Mini&quot;, &quot;Lat&quot;: -33.7857729, &quot;Long&quot;: 151.2899673
      }, &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [ 151.2899673, -33.785772899999586 ]
      }
    }
  ]
}
</code></pre></div> <p>Utiliser ceci:</p> <div class=highlight><pre><span></span><code>[
  {
    &quot;type&quot;: &quot;Feature&quot;, &quot;id&quot;: 0, &quot;properties&quot;: {
      &quot;Name&quot;: &quot;Queensie Mini&quot;, &quot;Lat&quot;: -33.7857729, &quot;Long&quot;: 151.2899673
    }, &quot;geometry&quot;: {
      &quot;type&quot;: &quot;Point&quot;,
      &quot;coordinates&quot;: [ 151.2899673, -33.785772899999586 ]
    }
  }
]
</code></pre></div> <p>Nos données étant au bon format, passons à la commande <code>mongoimport</code>. Par defaut cette commande se connecte au serveur local, ce qui réduit dans notre cas le nombre d'arguments à passer :</p> <div class=highlight><pre><span></span><code>mongoimport -d surfdb -c spot --type json --jsonArray --file data.json
</code></pre></div> <p>Si tout ce passe bien, vous devriez voir ça:</p> <div class=highlight><pre><span></span><code>connected to: 127.0.0.1
Fri Apr  4 00:13:22.965 check 9 32
Fri Apr  4 00:13:24.326 imported 32 objects
</code></pre></div> <p>En ouvrant une connection au serveur avec la commande <code>mongo</code>, nous pouvons maintenant accéder à nos données:</p> <div class=highlight><pre><span></span><code>mongo
&gt; use surfdb
show collections; // affiche les collections dans la base.
db.spot.stats(); // retourne les stats de la collection spot, type {Object}.
db.spot.findOne(); // retourne un document de la collection, type {Object}.
db.spot.find(); // retourne tous les documents de la collection, type [Array].
db.spot.find({&#39;properties.Name&#39;:&#39;Winki&#39;}) // retourne tous les documents qui ont comme proprieté &quot;properties.Name&quot; = &quot;Winki&quot;.
</code></pre></div> <p>C'est aussi simple que ça !</p> <p>C'est certes simple, mais à part stocker un pseudo geojson, ça ne sert pas à grand chose. Pour "activer" la fonction spatiale, mongo a besoin d'un index spacial. Toujours dans le terminal, serveur demarré [<code>mongod</code>] et connection active [<code>mongo</code>]...</p> <div class=highlight><pre><span></span><code>&gt; db.spot.ensureIndex({&#39;geometry&#39;:&#39;2dsphere&#39;}); // Explicite non ?
</code></pre></div> <p>C'est prêt :).</p> <p>Guillaume</p></div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>