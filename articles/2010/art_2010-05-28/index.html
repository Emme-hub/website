<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2010/art_2010-05-28/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>XAPI OSM - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li class=active> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../art_2010-06-02/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../art_2010-05-13/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#xapi-osm>XAPI OSM</a></li> <li><a href=#lapi-opentreetmap-v06>L'API OpentreetMap v0.6</a></li> <li><a href=#la-xapi-zappy>La XAPI ... zappy</a></li> <li><a href=#demonstration>Démonstration</a></li> <li><a href=#auteur>Auteur</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=xapi-osm>XAPI OSM<a class=headerlink href=#xapi-osm title="Permanent link">#</a></h1> <p>:calendar: Date de publication initiale : 28 mai 2010</p> <p><strong>Mots-clés :</strong> OpenStreetMap | Open Source | OSM | Xapi</p> <p><img alt=OSM_logo.png src=https://cdn.geotribu.fr/img/logos-icones/OpenStreetMap/Openstreetmap.png> OpenStreetMap est un formidable projet, on ne le dira jamais assez. La constitution d'une base de données mondiale pour la constitution d'une carte libre est une avancée majeure dans la libéralisation des données géographiques. Preuve en est, certaines villes françaises commencent à alimenter la base grâce à leurs propres données.<br> Cependant, mis à part le fait de visualiser la carte sur le <a href=http://www.openstreemap.org>site</a>, la façon dont on peut récupérer des données reste pour beaucoup de personnes assez obscure. Et pourtant, au delà des API existantes, il en existe une qui permet très facilement de 'requêter' la base afin d'obtenir les entités voulues.</p> <h4 id=lapi-opentreetmap-v06>L'API OpentreetMap v0.6<a class=headerlink href=#lapi-opentreetmap-v06 title="Permanent link">#</a></h4> <p>L'API principale (que j'aurais plutôt nommée protocole) d'OpenStreeMap est une Web API (type RESTful). Pour faire simple, cela signifie que les requête vont s'appuyer sur le protocole HTTP pour dialoguer avec le serveur. Si cette notion est totalement nouvelle pour vous, je vous conseille la lecture de l'excellent blog <a href=http://www.biologeek.com/rest,traduction,web-semantique/pour-ne-plus-etre-en-rest-comprendre-cette-architecture/ >BioloGeek</a> . Pour en revenir à XAPI, nous disions donc qu'elle permet d'interroger, via une URL, le serveur contenant les données afin d'effectuer toutes sortes d'opérations :</p> <ul> <li>ajout d'objets</li> <li>modification d'objets</li> <li>suppression d'objets Ces opérations entrainant des modifications dans la base, il est donc nécessaire de s'authentifier avant toutes actions. C'est d'ailleurs ce que vous faites quand vous utilisez des outils tels que <a href=http://wiki.openstreetmap.org/wiki/JOSM>JOSM</a> et <a href=http://wiki.openstreetmap.org/wiki/Potlatch>Potlatch</a>. Pour plus de facilité, l'API d'OSM a été traduite dans différents langages de programmation tels que <a href=http://osmlib.rubyforge.org/osmlib-base/rdoc/classes/OSM/API.html>Ruby</a>, <a href="http://sourceforge.net/apps/mediawiki/travelingsales/index.php?title=LibOSM">Java</a> ou encore <a href=http://wiki.openstreetmap.org/wiki/PythonOsmApi>Python</a>. Je n'ai rien trouvé concernant une implémentation PHP mais cela doit, très certainement, exister.</li> </ul> <p>L'authentification peut paraitre un peu compliquée et surtout superflue si vous souhaitez simplement télécharger quelques données sur une zone précise. C'est pourquoi il existe une API simplifiée, XAPI, qui permet d'interroger la base de données via une simple requête URL.</p> <h4 id=la-xapi-zappy>La XAPI ... zappy<a class=headerlink href=#la-xapi-zappy title="Permanent link">#</a></h4> <p>Cette <a href=http://wiki.openstreetmap.org/wiki/Xapi>API</a>, ne fonctionne qu'en lecture seule. Vous ne pourrez réaliser aucune modification sur la base. Ça tombe bien, c'est ce que nous souhaitons faire ici.</p> <h5 id=les-serveurs>Les serveurs<a class=headerlink href=#les-serveurs title="Permanent link">#</a></h5> <p>La XAPI tourne sur plusieurs serveurs différents, il est donc possible d'interroger la base de données sur ces derniers :</p> <ul> <li><a href=http://xapi.openstreetmap.org/api/0.6>http://xapi.openstreetmap.org/api/0.6</a></li> <li><a href=http://osmxapi.hypercube.telascience.org/api/0.6>http://osmxapi.hypercube.telascience.org/api/0.6</a></li> <li><a href=http://osm.bearstech.com/osmxapi/api/0.6>http://osm.bearstech.com/osmxapi/api/0.6</a> Cependant ces serveurs ne sont pas toujours en très grande forme. C'est pourquoi la réponse à une requête peut parfois être très longue. Mais rassurez-vous, là encore, cela est plutôt bien fait. En effet, <a href=http://www.informationfreeway.org/ >InformationFreeway</a> redirige la requête vers le serveur approprié : le début de la requête sera alors le suivant : <a href=http://www.informationfreeway.org/api/0.6>http://www.informationfreeway.org/api/0.6</a>.</li> </ul> <h5 id=la-construction-dune-requete>La construction d'une requête<a class=headerlink href=#la-construction-dune-requete title="Permanent link">#</a></h5> <p>Une requête est donc une simple URL bien formatée qui nous retournera un fichier XML. Celle-ci doit contenir les différents éléments ci-dessous :</p> <p><em>Bounding box</em></p> <p>Tout d'abord il convient de définir l'emprise géographique. Pour des raisons évidentes de charge serveur, une limitation a été instaurée :</p> <ul> <li>l'API normale avec authentification n'autorise une emprise géographique que de 0.25 degré carré.</li> <li>la XAPI, elle, permet une zone bien plus large : 100 degrés carré soit environ 788 000 km² à une latitude de 48° - à peu près Paris. La définition de l'emprise s'écrit donc de cette façon : </li> </ul> <p>GET /api/0.6/map?bbox=left,bottom,right,top </p> <ul> <li>left = longitude ouest</li> <li>bottom = latitude nord</li> <li>right = longitude est</li> <li>top = latitude sud Si vous ne connaissez pas l'étendue géographique de la zone que vous désirez intérroger, je vous renvoie vers l'astuce donnée sur le blog <a href=http://weait.com/content/map-tiles-and-bounding-boxes>weait</a>. Vous y trouverez tous les renseignements nécessaires.<br> Cette requête est équivalente à celle-ci - que nous préfèrerons par la suite parce qu'elle permet de 'poser' des questions sur les entités :</li> </ul> <p>GET /api/0.6/*[bbox=left,bottom,right,top] </p> <p><em>Les objets</em><br> OpenStreetMap propose 3 types d'entités : les noeuds, les chemins et les relations - cf. <a href=http://wiki.openstreetmap.org/wiki/Data_Primitives>ici</a></p> <ul> <li>Les noeuds sont des points.</li> <li>Les chemins sont des groupes de noeuds.</li> <li>Les relations sont composées de chemins et de noeuds ayant des rôles. <strong>Les noeuds</strong><br> Pour récupérer des noeuds sur une zone prédéfinie, ce n'est pas très compliqué : </li> </ul> <p>GET /api/0.6/node[amenity=pub][bbox=left,bottom,right,top] </p> <p>Notons que le principal tag des noeuds est <em>amenity</em> qui permet de spécifier le type du noeud. Voir la <a href=http://wiki.openstreetmap.org/wiki/FR:Key:amenity>liste</a> des valeurs principales.</p> <p><strong>Les ways</strong><br> Pour les chemins, c'est la même structure : </p> <p>GET /api/0.6/way[admin_level=8][bbox=left,bottom,right,top] </p> <p>Pour avoir les limites administratives de niveau 8 - les communes - sur la zone demandée.</p> <p><strong>Les relations</strong> </p> <p>GET /api/0.6/relation[landuse=residential][bbox=left,bottom,right,top] </p> <p>Pour les zones résidentielles.</p> <p>Voici la <a href=http://wiki.openstreetmap.org/wiki/FR:Map_Features>liste complète</a> des tags utilisés dans OSM. Evidemment cette liste n'est pas arrêtée, il est possible d'en proposer des nouveaux.<br> Il est possible aussi de voir la liste actualisée des relations en France grâce à <a href=http://tagwatch.stoecker.eu/France/En/ >Tagwatch</a>.</p> <p><strong>Note</strong> : il est malheureusement impossible pour le moment de 'demander' un objet ou un autre objet - le OR n'existe pas - il faut faire plusieurs requêtes.</p> <h4 id=demonstration>Démonstration<a class=headerlink href=#demonstration title="Permanent link">#</a></h4> <p>Un petit exemple sur Toulouse en affichant les positions des toilettes présentes dans la base de données.<br> Ici nous avons utilisé la classe Strategy Cluster d'OpenLayers pour représenter les données - cherchez un peu sur le site pour voir comment cette dernière fonctionne :-)</p> <hr> <h2 id=auteur>Auteur<a class=headerlink href=#auteur title="Permanent link">#</a></h2> <p><img alt="Portait de GeoTribu" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/internal/charte/geotribu_logo_64x64.png> <strong>GeoTribu</strong></p> <p>Toute l'actualité de la géomatique Open Source ! Mais aussi des tutoriels, des billets de blog, des tests et surtout une bonne humeur géographique !</p></div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>