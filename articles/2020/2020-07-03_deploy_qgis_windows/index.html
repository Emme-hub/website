<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2020/2020-07-03_deploy_qgis_windows/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>Installer QGIS sur Windows avec Powershell - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li class=active> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../2020-08-31_geotribu_histoire/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../2020-06-19_setup_python/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#installer-qgis-sur-windows-avec-powershell>Installer QGIS sur Windows avec Powershell</a></li> <li><a href=#comment-linstallateur-cli-fonctionne>Comment L'Installateur (CLI) fonctionne</a></li> <li><a href=#scriptons>Scriptons</a></li> <li><a href=#utiliser-le-script>Utiliser le script</a></li> <li><a href=#conclusion>Conclusion</a></li> <li><a href=#auteur>Auteur</a></li> <li class="main "><a href=#julien-moura>Julien Moura</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=installer-qgis-sur-windows-avec-powershell>Installer QGIS sur Windows avec Powershell<a class=headerlink href=#installer-qgis-sur-windows-avec-powershell title="Permanent link">#</a></h1> <p>:calendar: Date de publication initiale : 3 juillet 2020</p> <p><strong>Mots-clés :</strong> QGIS | Windows | Déploiement | Installation | Powershell</p> <p>L'installation et la mise à jour de QGIS peuvent être rébarbatives, notamment sous Windows où il n'est pas possible de profiter d'une mise à jour via une simple ligne de commande (<code>apt</code> mon amour :heart:)... Il y a quelques mois de cela, je cherchais à automatiser l'installation et la configuration de QGIS sur Windows et j'avais donc creusé du côté de <a href=https://qgis.org/fr/site/forusers/download.html>l'installateur de l'OSGeo</a>.</p> <p>J'avais abouti à un petit script Powershell et vu que j'avais trouvé cela pratique, je me l'étais mis de côté sur <a href=https://gist.github.com/Guts/6303dc5eb941eb24be3e27609cd46985>Gist</a>. Fidèle au <em>Geotribu Spirit</em> :copyright:{: .copyleft }, pourquoi ne pas partager le résultat et (surtout) la démarche ? :wink:</p> <div class="admonition info"> <p class=admonition-title>Prérequis</p> <ul> <li>une machine avec Windows et Powershell</li> <li>droits administrateur</li> <li>droits d'exécution de scripts, comme pour les environnements virtuels Python (voir <a href="https://docs.microsoft.com/fr-fr/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7">la doc Microsoft</a> ou <a href=/articles/2020/2020-06-19_setup_python/#autoriser-lutilisation-des-environnements-virtuels>cet article</a>) : <code>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser</code></li> <li>optionnellement : <a href=https://git-scm.com/ >Git</a></li> </ul> </div> <h2 id=comment-linstallateur-cli-fonctionne>Comment L'Installateur (CLI) fonctionne<a class=headerlink href=#comment-linstallateur-cli-fonctionne title="Permanent link">#</a></h2> <p>On l'oublie souvent (ou on ne le sait tout simplement pas, comme moi pendant de longues et heureuses années) mais les installateurs sont d'abord des outils en ligne de commande (des <a href=https://fr.wikipedia.org/wiki/Interface_en_ligne_de_commande>CLIs</a> comme disent les grandes personnes) qui proposent en prime une interface graphique... qui est rarement mieux qu'un concours de clics sur <code>Suivant</code>.</p> <p><img alt="OSGeo4W QGIS" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/qgis_deploy_windows/osgeo4w_qgis.png title="OSGeo for Windows et QGIS"></p> <h3 id=-help-ex-machina>--help ex machina<a class=headerlink href=#-help-ex-machina title="Permanent link">#</a></h3> <p>En regardant <a href=https://trac.osgeo.org/osgeo4w/wiki/CommandLine>l'aide de l'exécutable</a>, on s'aperçoit qu'il est possible de passer un certain nombre d'arguments :</p> <div class=highlight><pre><span></span><code><span class=c># ô installateur, dis-moi quels sont tes secrets</span>
<span class=n>osgeo4w-setup-x86_64</span><span class=p>.</span><span class=n>exe</span> <span class=p>-</span><span class=n>-help</span>
</code></pre></div> <p>Ce qui nous donne :</p> <div class=highlight><pre><span></span><code>Command Line Options:
 -b --disable-buggy-antivirus      Disable known or suspected buggy anti virus
                                   software packages during execution.
 -g --upgrade-also                 also upgrade installed packages
 -o --delete-orphans               remove orphaned packages
 -n --no-shortcuts                 Disable creation of desktop and start menu
                                   shortcuts
 -N --no-startmenu                 Disable creation of start menu shortcut
 -d --no-desktop                   Disable creation of desktop shortcut
 -r --no-replaceonreboot           Disable replacing in-use files on next
                                   reboot.
 -k --autoaccept                   Accept all licenses
 -l --local-package-dir            Local package directory
 -m --menu-name                    Menu name
 -a --arch                         architecture to install (x86_64 or x86)
 -R --root                         Root installation directory
 -q --quiet-mode                   Unattended setup mode
 -M --package-manager              Semi-attended chooser-only mode
 -h --help                         print help
 -p --proxy                        HTTP/FTP proxy (host:port)
 -x --remove-packages              Specify packages to uninstall
 -c --remove-categories            Specify categories to uninstall
 -P --packages                     Specify packages to install
 -C --categories                   Specify entire categories to install
 -D --download                     Download from internet
 -L --local-install                Install from local directory
 -t --test                         Use setup_test.ini
 -A --advanced                     Advanced install (as opposed to Express)
 -S --safe                         Safe Mode (Skip some admin actions)
 -s --site                         Download site
 -O --only-site                    Ignore all sites except for -s
</code></pre></div> <p>Avec tout ça, on a de quoi faire un joli script dont l'idée est de :</p> <ol> <li>télécharger l'installateur</li> <li>l'utiliser pour télécharger les packages de QGIS LTR</li> <li>l'utiliser pour installer les packages</li> </ol> <p>En avant :nerd_face: !</p> <hr> <h2 id=scriptons>Scriptons<a class=headerlink href=#scriptons title="Permanent link">#</a></h2> <p>A l'instar de beaucoup de choses dans Windows, le langage de script Powershell a une syntaxe très verbeuse plutôt lourde, du genre "Pourquoi faire simple quand on peut faire compliqué ?"... mais vient avec une interface graphique permettant de se repérer : <a href=https://docs.microsoft.com/fr-fr/powershell/scripting/windows-powershell/ise/introducing-the-windows-powershell-ise>ISE</a>.</p> <p>Je détaille ici les étapes du script mais en cas d'empressement, voir la partie <a href=#utiliser-le-script>Utiliser le script</a>.</p> <h3 id=sudoku>Sudoku<a class=headerlink href=#sudoku title="Permanent link">#</a></h3> <p>Tout d'abord, on s'assure que le script est bien lancé en mode administrateur :</p> <div class=highlight><pre><span></span><code><span class=c>#Requires -RunAsAdministrator</span>
</code></pre></div> <h3 id=telecharger-linstallateur>Télécharger l'installateur<a class=headerlink href=#telecharger-linstallateur title="Permanent link">#</a></h3> <p>Histoire de respecter les bonnes pratiques du système, on va télécharger l'installateur dans le dossier <code>Téléchargements</code> de l'utilisateur :</p> <div class=highlight><pre><span></span><code><span class=c># on se met le chemin actif de côté pour y revenir en toute fin</span>
<span class=nv>$starter_path</span> <span class=p>=</span> <span class=nb>Get-Location</span>
<span class=c># on se déplace dans le dossier téléchargement de l&#39;utilisateur</span>
<span class=nb>Set-Location</span> <span class=n>-Path</span> <span class=s2>&quot;$env:USERPROFILE/Downloads&quot;</span>
</code></pre></div> <p>Une fois au bon endroit, on télécharge l'installateur, sauf s'il existe déjà dans le dossier :</p> <div class=highlight><pre><span></span><code><span class=k>if</span> <span class=p>(</span><span class=o>-Not</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=s2>&quot;osgeo4w-setup-x86_64.exe&quot;</span> <span class=n>-PathType</span> <span class=n>leaf</span> <span class=p>))</span> <span class=p>{</span>
   <span class=nb>Invoke-WebRequest</span> <span class=n>-Uri</span> <span class=s2>&quot;https://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe&quot;</span> <span class=n>-OutFile</span> <span class=s2>&quot;osgeo4w-setup-x86_64.exe&quot;</span>
<span class=p>}</span>
</code></pre></div> <h3 id=lancer-le-telechargement-et-linstallation>Lancer le téléchargement et l'installation<a class=headerlink href=#lancer-le-telechargement-et-linstallation title="Permanent link">#</a></h3> <p>Après un avoir regardé de plus près les options de l'installateur <a href=https://trac.osgeo.org/osgeo4w/wiki/OSGeo4W_fr>OSGeo4W</a>, voici à quoi va ressembler notre commande que j'ai détaillée et mis en multi-lignes pour que ce soit plus lisible :</p> <div class=highlight><pre><span></span><code><span class=p>.\</span><span class=n>osgeo4w-setup-x86_64</span><span class=p>.</span><span class=n>exe</span> <span class=p>`</span>
    <span class=p>-</span><span class=n>-advanced</span> <span class=p>`</span>                <span class=c># correspond à l&#39;option Advanced Install</span>
    <span class=p>-</span><span class=n>-arch</span> <span class=n>x86_64</span> <span class=p>`</span>             <span class=c># on est en 2020...</span>
    <span class=p>-</span><span class=n>-autoaccept</span> <span class=p>`</span>              <span class=c># accepte toutes les licences</span>
    <span class=p>-</span><span class=n>-delete-orphans</span> <span class=p>`</span>          <span class=c># supprime les paquets inutilisés</span>
    <span class=p>-</span><span class=n>-no-desktop</span> <span class=p>`</span>              <span class=c># ne pas créer d&#39;icône sur le bureau</span>
    <span class=p>-</span><span class=n>-packages</span> <span class=n>qgis-ltr-full</span> <span class=p>`</span>  <span class=c># le paquet (en fait le meta-paquet) souhaité</span>
    <span class=p>-</span><span class=n>-quiet-mode</span> <span class=p>`</span>              <span class=c># ne pas demander d&#39;action de l&#39;utilisateur</span>
    <span class=p>-</span><span class=n>-site</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>download</span><span class=p>.</span><span class=n>osgeo</span><span class=p>.</span><span class=n>org</span><span class=p>/</span><span class=n>osgeo4w</span> <span class=p>`</span>  <span class=c># le serveur principal d&#39;où télécharger les paquets</span>
    <span class=p>-</span><span class=n>-site</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>osgeo4w-oslandia</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>mirror</span>   <span class=c># le miroir d&#39;Oslandia</span>
    <span class=p>-</span><span class=n>-upgrade-also</span>              <span class=c># met à jour les paquets</span>
</code></pre></div> <p>Concrètement, les packages sont téléchargés dans le dossier temporaire de l'utilisateur (classiquement : <code>C:\Users\USERNAME\AppData\Local\Temp\{url_site}</code>) puis sont décompressés et déplacés vers le dossier habituel de l'installateur : <code>C:\OSGeo4W64</code>. Il est possible de modifier ces deux emplacements via respectivement les options <code>--local-package-dir</code> et <code>--root</code>.</p> <div class="admonition tip"> <p class=admonition-title>Serveurs (sites) de téléchargement</p> <p>L'option <code>-s/--site</code> est répétable afin de pouvoir passer plusieurs serveurs (comme dans l'interface graphique) et les URLs doivent faire partie de ce fichier <code>https://download.osgeo.org/osgeo4w/mirrors.lst</code>.</p> </div> <hr> <h2 id=utiliser-le-script>Utiliser le script<a class=headerlink href=#utiliser-le-script title="Permanent link">#</a></h2> <p>Maintenant qu'on a compris les différentes étapes, voici comment utiliser le script que j'ai publié facilement.</p> <h3 id=1-recuperer-le-script>1. Récupérer le script<a class=headerlink href=#1-recuperer-le-script title="Permanent link">#</a></h3> <p>Si vous avez installé <a href=https://git-scm.com/ >Git</a>, lancer le terminal Powershell :</p> <div class=highlight><pre><span></span><code><span class=c># cloner le script</span>
<span class=n>git</span> <span class=n>clone</span> <span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>gist</span><span class=p>.</span><span class=n>github</span><span class=p>.</span><span class=n>com</span><span class=p>/</span><span class=n>6303dc5eb941eb24be3e27609cd46985</span><span class=p>.</span><span class=n>git</span> <span class=n>qgis-deploy-win</span>
<span class=c># entrer dans le répertoire ainsi créé</span>
<span class=nb>cd </span><span class=p>.\</span><span class=n>qgis-deploy-win</span><span class=p>\</span>
</code></pre></div> <p>Sinon il est possible de <a href=https://gist.github.com/Guts/6303dc5eb941eb24be3e27609cd46985/archive/7d1bc758aa274f66ce0b0fd50529f2fa2ab4e9af.zip>télécharger le script via ce lien</a> et dézipper le tout.</p> <p>En listant le contenu avec un bon <code>ls</code> des familles, voici ce que l'on obtient :</p> <p><img alt="Répertoire du gist du script powershell" src=https://cdn.geotribu.fr/img/tuto/qgis_deploy_windows/qgis_deploy_win_gist_overview.png title="Contenu du répertoire du Gist"></p> <h3 id=2-executer-le-script>2. Exécuter le script<a class=headerlink href=#2-executer-le-script title="Permanent link">#</a></h3> <p>Lancer le terminal en mode administrateur cette fois et exécuter le script :</p> <div class=highlight><pre><span></span><code><span class=p>.\</span><span class=n>qgis_deploy_install_upgrade_ltr</span><span class=p>.</span><span class=n>ps1</span>
</code></pre></div> <p>Le téléchargement des packages se lance :</p> <p><img alt="Téléchargement des packages" src=https://cdn.geotribu.fr/img/tuto/qgis_deploy_windows/qgis_deploy_win_prog.png title="Téléchargement des packages de QGIS LTR"></p> <p>Puis l'installation :</p> <p><img alt=Installation src=https://cdn.geotribu.fr/img/tuto/qgis_deploy_windows/qgis_deploy_win_prog_postinstall.png title="Installation des packages de QGIS LTR"></p> <p>Le temps d'un café (ou d'une bière) et hop, on est prêt pour de nouvelles aventures avec QGIS !</p> <p>:coffee:/:beer: &rarr; :rocket:</p> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">#</a></h2> <p>On voit donc qu'il est possible d'automatiser l'installation et le déploiement de QGIS, mais aussi de tous les logiciels et packages auxquels l'installateur <a href=https://trac.osgeo.org/osgeo4w/wiki/OSGeo4W_fr>OSGeo4W</a> donne accès.</p> <hr> <div class="admonition tip"> <p class=admonition-title>Pour la route</p> <p>Pour info, il est également possible d'utiliser <a href=https://chocolatey.org/ >Chocolatey</a> :</p> <div class=highlight><pre><span></span><code><span class=n>choco</span> <span class=n>install</span> <span class=n>qgis-ltr</span>
</code></pre></div> </div> <hr> <h2 id=auteur>Auteur<a class=headerlink href=#auteur title="Permanent link">#</a></h2> <h1 id=julien-moura>Julien Moura<a class=headerlink href=#julien-moura title="Permanent link">#</a></h1> <p><img alt="Portrait Julien Moura" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/internal/contributeurs/jmou.jfif title="Portrait Julien Moura"></p> <p>Géographe "sigiste" de formation, j'ai d'abord travaillé sur différentes thématiques et types de structures : la gestion des déchets en milieu urbain à Madagascar, le foncier d'intérêt général auprès de <a href=http://www.epf-reunion.com/ >l'EPF de La Réunion</a>, l'organisation et la résilience urbaine face aux risques naturels à Lima pour l'IRD.</p> <p>C'est en m'intéressant à la gouvernance et à l'ouverture des données géographiques que je travaille à <a href=https://www.isogeo.com>Isogeo</a> quelques années. L'occasion d'asseoir mes compétences en développement et gestion de produit informatique. En 2020, je deviens indépendant (In Geo Veritas) puis rejoins les rangs d'<a href=https://oslandia.com/ >Oslandia</a>.</p> <p>Féru des dynamiques de contributions, je participe activement à Geotribu depuis fin 2011 et, comme ça me manquait trop, j'ai décidé de lancer sa renaissance en 2020.</p> </div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>