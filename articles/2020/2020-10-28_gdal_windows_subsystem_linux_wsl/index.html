<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2020/2020-10-28_gdal_windows_subsystem_linux_wsl/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>Utiliser GDAL sous Windows avec WSL (Windows Subsystem for Linux) - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li class=active> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../2020-11-21_openstreetmap_street_complete/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../2020-10-19_geogame_desert/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#utiliser-gdal-sur-windows-via-le-sous-systeme-pour-linux>Utiliser GDAL sur Windows via le sous-système pour Linux</a></li> <li><a href=#introduction>Introduction</a></li> <li><a href=#installer-wsl>Installer WSL</a></li> <li><a href=#utiliser-gdal-dans-le-sous-systeme-linux-de-windows>Utiliser GDAL dans le sous-système Linux de Windows</a></li> <li><a href=#bonux-stage>Bonux stage</a></li> <li><a href=#conclusion>Conclusion</a></li> <li><a href=#auteurs>Auteurs</a></li> <li class="main "><a href=#julien-moura>Julien Moura</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=utiliser-gdal-sur-windows-via-le-sous-systeme-pour-linux>Utiliser GDAL sur Windows via le sous-système pour Linux<a class=headerlink href=#utiliser-gdal-sur-windows-via-le-sous-systeme-pour-linux title="Permanent link">#</a></h1> <p>:calendar: Date de publication initiale : 28 octobre 2020</p> <p><strong>Mots-clés :</strong> GDAL | OGR | Windows | WSL | Linux</p> <p>Pré-requis :</p> <ul> <li>un <a href=#version-minimale-de-windows>Windows à jour</a></li> <li>un compte avec les droits d'administrateur (au moins durant la phase d'installation)</li> </ul> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">#</a></h2> <p><img alt="icône GDAL" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/logos-icones/logiciels_librairies/gdal.png title="logo GDAL"></p> <p>Récemment, j'ai eu à traiter des données particulièrement lourdes (millions d'objets) et imparfaites (mauvaises géométries dans un shapefiles) et mes outils habituels étaient tenus en échec : QGIS prend des plombes puis plante presque systématiquement lors des traitements de nettoyage et de restructuration, le GDAL sur mon ordinateur ou sur mon Google Colab sont cantonnés à la version 3.0.* liée au socle Ubuntu 18.04 alors que j'ai bien besoin des options de la branche 3.1 (<code>-nlt</code>, <code>-makevalid</code>...).</p> <p>J'ai à ma disposition un ordinateur puissant sous Windows, mais l'accès à GDAL via l'<a href=/articles/2020/2020-07-03_deploy_qgis_windows/ >OSGeo4W</a> n'est pas idéal et complexe (cmd, proxy, politique de sécurité...), j'ai pas le coeur à <a href=/articles/2013/art_2013-09-26/#installer-gdalogr>l'installer au niveau du système</a> (effets de bord, conflits...) et utiliser conda revient à télécharger la moitié du Web (troll).</p> <p>Alors pourquoi ne pas essayer de mettre à profit WSL que <a href=https://twitter.com/geojulien/status/1139811447414775808>j'utilise déjà pour le développement ou le test</a> ?</p> <p><a data-mediabox=ligthbox-gallery data-title="Architecture WSL 2" href=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl2_architecture.png><img alt="Architecture WSL 2" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl2_architecture.png title="UArchitecture WSL 2"></a></p> <p>WSL ? Le Windows Subsystem for Linux (dont <a href=https://github.com/microsoft/WSL2-Linux-Kernel>le code du noyau est sous GPL-2</a>) permet depuis quelques années déjà de faire tourner un terminal bash sous Windows et ainsi bénéficier de l'usage des programmes populaires de l'écosystème Linux. Dans ce tutoriel, nous verrons comment installer et configurer WSL sur Windows 10, puis nous verrons les possibilités que cela ouvre en installant et utilisant GDAL dans le sous-système Linux.</p> <p>Deux étapes dans ce tutoriel :</p> <ul> <li><a href=#installer-wsl>installer et configurer le sous-système</a> Windows pour Linux</li> <li><a href=#utiliser-gdal-dans-le-sous-systeme-linux-de-windows>utiliser GDAL 3.1.* dans Ubuntu 20.04</a> sans quitter son terminal Windows, ni déployer une grosse VM ou autre</li> </ul> <h2 id=installer-wsl>Installer WSL<a class=headerlink href=#installer-wsl title="Permanent link">#</a></h2> <p>Même si <a href=https://docs.microsoft.com/fr-fr/windows/wsl/install-win10>la documentation</a> est très bien faite et même traduite en français, il me semble intéressant de paraphraser la documentation, me permettant d'y apporter quelques précisions au passage.</p> <h3 id=verifier-les-pre-requis>Vérifier les pré-requis<a class=headerlink href=#verifier-les-pre-requis title="Permanent link">#</a></h3> <h4 id=version-minimale-de-windows>Version minimale de Windows<a class=headerlink href=#version-minimale-de-windows title="Permanent link">#</a></h4> <p>Il existe actuellement deux versions différentes du sous-système Windows pour Linux. La version 2 est une fonctionnalité très récente, il faut donc s'assurer que la version de Windows est bien dans les clous.</p> <p>On ouvre son terminal Powershell :</p> <div class=highlight><pre><span></span><code><span class=nb>PS </span><span class=n>C</span><span class=err>:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>geojulien</span><span class=p>&gt;</span> <span class=n>systeminfo</span> <span class=p>|</span> <span class=n>findstr</span> <span class=p>/</span><span class=n>B</span> <span class=p>/</span><span class=n>C</span><span class=err>:</span><span class=s2>&quot;OS Name&quot;</span> <span class=p>/</span><span class=n>C</span><span class=err>:</span><span class=s2>&quot;OS Version&quot;</span> <span class=p>/</span><span class=n>C</span><span class=err>:</span><span class=s2>&quot;System Type&quot;</span>
<span class=n>OS</span> <span class=n>Name</span><span class=err>:</span>                   <span class=n>Microsoft</span> <span class=n>Windows</span> <span class=n>10</span> <span class=n>Pro</span>
<span class=hll><span class=n>OS</span> <span class=n>Version</span><span class=err>:</span>                <span class=n>10</span><span class=p>.</span><span class=n>0</span><span class=p>.</span><span class=n>19041</span> <span class=n>N</span><span class=p>/</span><span class=n>A</span> <span class=n>Build</span> <span class=n>19041</span>
</span><span class=n>System</span> <span class=n>Type</span><span class=err>:</span>               <span class=n>x64-based</span> <span class=n>PC</span>
</code></pre></div> <p>Si le numéro du build est supérieur ou égal à <code>18362</code> (ou <code>19041</code> pour les socles ARM), c'est bon. Sinon, revenez après avoir fait vos mises à jour :wave:.</p> <h4 id=un-terminal-moderne>Un terminal moderne<a class=headerlink href=#un-terminal-moderne title="Permanent link">#</a></h4> <p>Comme déjà évoqué dans <a href=/articles/2020/2020-06-19_setup_python/#utiliser-powershell>l'article sur l'environnement de travail Python sur Windows</a>, utiliser <code>cmd</code> n'est pas une option et il va falloir entrer quelques commandes Powershell pour ensuite profiter joyeusement de bash :partying_face:.</p> <p>Avec WSL, les choses se compliquent car il devient nécessaire de pouvoir switcher d'un terminal à l'autre, par exemple d'un Powershell sur le Windows hôte vers le bash de l'une des distributions installées avec WSL. Le terminal intégré de Powershell en étant incapable, il nous faut donc installer le <strong>nouveau terminal</strong> :</p> <ul> <li>depuis <a href=https://aka.ms/terminal>le Windows Store</a> - <strong>méthode recommandée</strong></li> <li>avec winget : <code>winget install --id=Microsoft.WindowsTerminal -e</code></li> <li>avec chocolatey : <code>choco install microsoft-windows-terminal</code></li> <li>avec <a href=https://github.com/microsoft/terminal/releases/download/v1.3.2651.0/Microsoft.WindowsTerminal_1.3.2651.0_8wekyb3d8bbwe.msixbundle>le MSIX Bundle</a> - mais attention, ça ne gère pas les futures mises à jour automatiques</li> </ul> <details class=danger><summary>Regarder le spot de pub d'inspiration éro-automobile :underage:</summary><p align=middle><iframe width=560 height=315 src=https://www.youtube-nocookie.com/embed/8gw0rXPMMPE frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p> </details> <h3 id=installer-wsl_1>Installer WSL<a class=headerlink href=#installer-wsl_1 title="Permanent link">#</a></h3> <p>WSL faisant partie du bouquet de fonctionnalités avancées, il faut donc un accès administrateur pour l'activer (par la suite, ce sera ok pour un utilisateur de base) :</p> <ol> <li> <p>Activer WSL et la VM</p> <div class=highlight><pre><span></span><code><span class=c># activer la fonctionnalité</span>
<span class=n>dism</span><span class=p>.</span><span class=n>exe</span> <span class=p>/</span><span class=n>online</span> <span class=p>/</span><span class=nb>enable-feature</span> <span class=p>/</span><span class=n>featurename</span><span class=err>:</span><span class=n>Microsoft-Windows-Subsystem-Linux</span> <span class=p>/</span><span class=n>all</span> <span class=p>/</span><span class=n>norestart</span>
<span class=c># activer la machine virtuelle</span>
<span class=n>dism</span><span class=p>.</span><span class=n>exe</span> <span class=p>/</span><span class=n>online</span> <span class=p>/</span><span class=nb>enable-feature</span> <span class=p>/</span><span class=n>featurename</span><span class=err>:</span><span class=n>VirtualMachinePlatform</span> <span class=p>/</span><span class=n>all</span> <span class=p>/</span><span class=n>norestart</span>
</code></pre></div> </li> <li> <p>Redémarrer l'ordinateur</p> </li> <li><a href=https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi>Télécharger</a> et installer la version 2 du noyau WSL</li> <li>Définir la version à utiliser : <code>wsl --set-default-version 2</code></li> </ol> <p>En cas de doute, se référer à <a href=https://docs.microsoft.com/fr-fr/windows/wsl/install-win10>la documentation officielle</a> et/ou harceler votre DSI.</p> <h3 id=installer-une-ou-plusieurs-distributions>Installer une ou plusieurs distributions<a class=headerlink href=#installer-une-ou-plusieurs-distributions title="Permanent link">#</a></h3> <p>Une fois le sous-système prêt, il est temps d'installer une ou plusieurs distributions Linux parmi celles disponibles (voir <a href=https://docs.microsoft.com/fr-fr/windows/wsl/install-win10#step-6---install-your-linux-distribution-of-choice>la liste ici</a>).</p> <ol> <li>pour ce tutoriel, on a besoin de télécharger <a href=https://www.microsoft.com/store/apps/9n6svws3rx71>Ubuntu 20.04</a></li> <li>au premier lancement, créer son utilisateur (voir <a href=https://docs.microsoft.com/fr-fr/windows/wsl/user-support>page dédiée de la doc</a>)</li> <li>Mettre à jour les paquets avec un bon vieux <code>sudo apt update &amp;&amp; sudo apt upgrade</code></li> <li>Fermer la fenêtre</li> </ol> <p>Voilà, désormais nous avons notre distribution Ubuntu 20.04 prête à être utilisée dans notre Windows. Allez, on ne s'arrête pas en si bon chemin : on continue vers l'installation de GDAL !</p> <hr> <h2 id=utiliser-gdal-dans-le-sous-systeme-linux-de-windows>Utiliser GDAL dans le sous-système Linux de Windows<a class=headerlink href=#utiliser-gdal-dans-le-sous-systeme-linux-de-windows title="Permanent link">#</a></h2> <p>Une fois notre distribution installée, continuons nos opérations sur notre nouveau terminal.</p> <p>Avant d'aller plus loin, quelques commandes à retenir, qui sont évidemment disponibles (et même traduites !) via l'argument <code>--help</code> :</p> <p><a data-mediabox=ligthbox-gallery data-title="Changer de shell encore plus facilement que de chemise" href=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_terminal_tabs.png><img alt="Onglets WSL dans Windows Terminal" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_terminal_tabs.png title="Titre image"></a></p> <h3 id=lister-les-distributions-installees>Lister les distributions installées<a class=headerlink href=#lister-les-distributions-installees title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><span class=n>wsl</span> <span class=p>-</span><span class=n>-list</span>
</code></pre></div> <p>Chez moi, cela donne :</p> <div class=highlight><pre><span></span><code><span class=n>Distributions</span> <span class=n>du</span> <span class=n>sous-système</span> <span class=n>Windows</span> <span class=n>pour</span> <span class=n>Linux</span> <span class=err>:</span>
<span class=n>Ubuntu</span><span class=p>-</span><span class=n>20</span><span class=p>.</span><span class=n>04</span> <span class=p>(</span><span class=n>par</span> <span class=n>défaut</span><span class=p>)</span>
<span class=n>docker-desktop</span>
<span class=n>docker-desktop-data</span>
<span class=n>Debian</span>
<span class=n>Ubuntu</span><span class=p>-</span><span class=n>18</span><span class=p>.</span><span class=n>04</span>
</code></pre></div> <h3 id=entrersortir-dans-une-distribution>Entrer/sortir dans une distribution<a class=headerlink href=#entrersortir-dans-une-distribution title="Permanent link">#</a></h3> <p>Cela se passe avec l'option <code>-d / --distribution</code> avec le nom de la distribution souhaitée. Dans notre cas :</p> <div class=highlight><pre><span></span><code><span class=n>wsl</span> <span class=n>-d</span> <span class=n>Ubuntu</span><span class=p>-</span><span class=n>20</span><span class=p>.</span><span class=n>04</span>
</code></pre></div> <p>Pour en sortir, il suffit de taper <code>exit</code>.</p> <h3 id=installer-gdal-sur-notre-ubuntu-2004>Installer GDAL sur notre Ubuntu 20.04<a class=headerlink href=#installer-gdal-sur-notre-ubuntu-2004 title="Permanent link">#</a></h3> <p>Nous voilà enfin dans notre environnement bash chéri :heart_eyes: !</p> <p>Rien que du très classique, donc d'abord, on définit la version de GDAL que l'on souhaite :</p> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>GDAL_VERSION</span><span class=o>=</span><span class=m>3</span>.1.*
</code></pre></div> <p>Ensuite, on ajoute le dépôt bien connu d'ubuntugis :</p> <div class=highlight><pre><span></span><code>sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable <span class=o>&amp;&amp;</span> sudo apt-get update
</code></pre></div> <p>Puis, on installe GDAL :</p> <div class=highlight><pre><span></span><code>sudo apt install gdal-bin<span class=o>=</span><span class=nv>$GDAL_VERSION</span> libgdal-dev<span class=o>=</span><span class=nv>$GDAL_VERSION</span>
<span class=nb>export</span> <span class=nv>CPLUS_INCLUDE_PATH</span><span class=o>=</span>/usr/include/gdal
<span class=nb>export</span> <span class=nv>C_INCLUDE_PATH</span><span class=o>=</span>/usr/include/gdal
</code></pre></div> <p>Et enfin, on vérifie que tout va bien :</p> <div class=highlight><pre><span></span><code>$ ogrinfo --version
GDAL <span class=m>3</span>.1.3, released <span class=m>2020</span>/09/01
</code></pre></div> <h3 id=lancer-des-commandes-des-vraies>Lancer des commandes, des vraies<a class=headerlink href=#lancer-des-commandes-des-vraies title="Permanent link">#</a></h3> <p>L'un des atouts de ce système est de pouvoir exécuter GDAL (ou tout autre commande propre à la distribution) à l'intérieur de la VM (Ubuntu) mais en pointant de façon transparente sur le système de fichiers hôte (Windows).</p> <p>Par exemple, on peut directement lancer la commande précédente depuis Powershell :</p> <div class=highlight><pre><span></span><code><span class=nb>PS </span><span class=n>C</span><span class=err>:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>geojulien</span><span class=p>&gt;</span> <span class=n>wsl</span> <span class=n>-d</span> <span class=n>Ubuntu</span><span class=p>-</span><span class=n>20</span><span class=p>.</span><span class=n>04</span> <span class=p>--</span> <span class=n>ogrinfo</span> <span class=p>-</span><span class=n>-version</span>
<span class=n>GDAL</span> <span class=n>3</span><span class=p>.</span><span class=n>1</span><span class=p>.</span><span class=n>3</span><span class=p>,</span> <span class=n>released</span> <span class=n>2020</span><span class=p>/</span><span class=n>09</span><span class=p>/</span><span class=n>01</span>
</code></pre></div> <p>Pour aller plus loin, considérons un petit scénario d'exemple dans lequel on souhaite :</p> <ol> <li>télécharger une donnée ouverte (au hasard : <a href=https://www.data.gouv.fr/fr/datasets/bassins-de-mobilite-scolaire-normandie/ >les bassins de mobilité scolaire en Normandie</a>, version convertie à la volée),</li> <li>vérifier rapidement son état avec <a href=https://gdal.org/programs/ogrinfo.html>ogrinfo</a></li> <li>convertir en couche de GeoPackage (parce-que c'est la hype), en appliquant des contrôles géométriques</li> </ol> <p>Et tout ça, en lançant les commandes depuis Powershell !</p> <h4 id=telecharger-la-donnee-avec-wget>Télécharger la donnée avec wget<a class=headerlink href=#telecharger-la-donnee-avec-wget title="Permanent link">#</a></h4> <p>A l'instar des autres utilitaires intégrés de base dans Ubuntu, <code>wget</code> n'attend que d'être utilisé via WSL :</p> <div class=highlight><pre><span></span><code><span class=c># wget est accessible, pourquoi se priver ?</span>
<span class=n>wsl</span> <span class=n>-d</span> <span class=n>Ubuntu</span><span class=p>-</span><span class=n>20</span><span class=p>.</span><span class=n>04</span> <span class=p>--</span> <span class=nb>wget </span><span class=n>https</span><span class=err>:</span><span class=p>//</span><span class=n>www</span><span class=p>.</span><span class=n>data</span><span class=p>.</span><span class=n>gouv</span><span class=p>.</span><span class=n>fr</span><span class=p>/</span><span class=n>fr</span><span class=p>/</span><span class=n>datasets</span><span class=p>/</span><span class=n>r</span><span class=p>/</span><span class=n>931cb357</span><span class=p>-</span><span class=n>33e6</span><span class=p>-</span><span class=n>46d6</span><span class=p>-</span><span class=n>8d2c-a17be9038e90</span> <span class=n>-O</span> <span class=n>test_gdal_wsl</span><span class=p>.</span><span class=n>shp</span><span class=p>.</span><span class=n>zip</span>
</code></pre></div> <p><a data-mediabox=ligthbox-gallery data-title="Une commande wget comme on les aime" href=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_wget_from_datagouv.png><img alt="capture wget wsl" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_wget_from_datagouv.png title="Une commande wget comme on les aime"></a></p> <p>Et voilà mon fichier dans mon explorateur Windows :</p> <p><a data-mediabox=ligthbox-gallery data-title="Résultat du téléchargement avec wget dans Windows" href=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_wget_result_explorer.png><img alt="capture wget wsl file explorer" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_wget_result_explorer.png title="Résultat du téléchargement avec wget dans Windows"></a></p> <h4 id=un-petit-ogrinfo-des-familles>Un petit ogrinfo des familles<a class=headerlink href=#un-petit-ogrinfo-des-familles title="Permanent link">#</a></h4> <p>On peut donc regarder de plus près notre fichier téléchargé avec un bon vieux <a href=https://gdal.org/programs/ogrinfo.html>ogrinfo</a> :</p> <div class=highlight><pre><span></span><code><span class=c># ogrinfo</span>
<span class=n>wsl</span> <span class=n>-d</span> <span class=n>Ubuntu</span><span class=p>-</span><span class=n>20</span><span class=p>.</span><span class=n>04</span> <span class=p>--</span> <span class=n>ogrinfo</span> <span class=n>-al</span> <span class=n>-so</span> <span class=n>test_gdal_wsl</span><span class=p>.</span><span class=n>shp</span><span class=p>.</span><span class=n>zip</span>
</code></pre></div> <p><a data-mediabox=ligthbox-gallery data-title="ogrinfo dans Windows via WSL" href=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_ogrinfo.png><img alt="capture wsl ogrinfo" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_ogrinfo.png title="ogrinfo dans Windows via WSL"></a></p> <h4 id=contribuons-a-la-fin-du-regne-du-shapefiles>Contribuons à la fin du règne du Shapefiles<a class=headerlink href=#contribuons-a-la-fin-du-regne-du-shapefiles title="Permanent link">#</a></h4> <p>Histoire de faire les choses jusqu'au bout, on veut alors lancer un traitement sur nos données :</p> <ul> <li>convertir le shapefiles en couche de geopackage</li> <li>s'assurer qu'il n'y ait qu'un seul type de géométrie et que les polygones soient valides</li> <li>supprimer les Z et M</li> <li>reprojeter en 3857 (web map en ligne de mire)</li> </ul> <p>On lance donc <a href=https://gdal.org/programs/ogr2ogr.html>ogr2ogr</a> :</p> <div class=highlight><pre><span></span><code><span class=n>wsl</span> <span class=n>-d</span> <span class=n>Ubuntu</span><span class=p>-</span><span class=n>20</span><span class=p>.</span><span class=n>04</span> <span class=p>--</span> <span class=n>ogr2ogr</span> <span class=n>-t_srs</span> <span class=n>EPSG</span><span class=err>:</span><span class=n>3857</span> <span class=o>-f</span> <span class=n>GPKG</span> <span class=s2>&quot;geotribu_gdal_wsl_gpkg.gpkg&quot;</span> <span class=s2>&quot;test_gdal_wsl.shp.zip&quot;</span> <span class=n>-nln</span> <span class=s2>&quot;GDAL_Windows_SO_SIMPLE&quot;</span> <span class=n>-nlt</span> <span class=n>POLYGON</span> <span class=n>-dim</span> <span class=n>2</span> <span class=n>-overwrite</span> <span class=n>-makevalid</span>
</code></pre></div> <p>Et on ouvre notre couche dans QGIS :</p> <p><a data-mediabox=ligthbox-gallery data-title="La couche du geopackage dans QGIS en sortie d'ogr2ogr via WSL" href=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_ogr2ogr_result_qgis.png><img alt="capture qgis résultat ogr2ogr" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/gdal_wsl/wsl_ogr2ogr_result_qgis.png title="ogrinfo dans Windows via WSL"></a></p> <hr> <h2 id=bonux-stage>Bonux stage<a class=headerlink href=#bonux-stage title="Permanent link">#</a></h2> <h3 id=personnaliser-le-terminal>Personnaliser le terminal<a class=headerlink href=#personnaliser-le-terminal title="Permanent link">#</a></h3> <p>Dans le nouveau terminal, il est possible de <a href=https://docs.microsoft.com/fr-fr/windows/terminal/customize-settings/profile-settings>personnaliser chaque shell répertorié</a> histoire de s'y retrouver facilement ou tout simplement de faire les choses à son goût.</p> <details class=example><summary>Ma configuration (objet <code>profiles/list</code>)</summary><p> <div class=highlight><pre><span></span><code>{
&quot;list&quot;:
    [
        {
            // Make changes here to the powershell.exe profile.
            &quot;guid&quot;: &quot;{61c54bbd-c2c6-5271-96e7-009a87ff44bf}&quot;,
            &quot;name&quot;: &quot;Windows PowerShell&quot;,
            &quot;commandline&quot;: &quot;powershell.exe&quot;,
            &quot;hidden&quot;: false
        },
        {
            // Make changes here to the cmd.exe profile.
            &quot;guid&quot;: &quot;{0caa0dad-35be-5f56-a8ff-afceeeaa6101}&quot;,
            &quot;name&quot;: &quot;Invite de commandes&quot;,
            &quot;commandline&quot;: &quot;cmd.exe&quot;,
            &quot;hidden&quot;: false
        },
        {
            &quot;guid&quot;: &quot;{b453ae62-4e3d-5e58-b989-0a998ec441b8}&quot;,
            &quot;hidden&quot;: true,
            &quot;name&quot;: &quot;Azure Cloud Shell&quot;,
            &quot;source&quot;: &quot;Windows.Terminal.Azure&quot;
        },
        {
            &quot;guid&quot;: &quot;{58ad8b0c-3ef8-5f4d-bc6f-13e4c00f2530}&quot;,
            &quot;hidden&quot;: false,
            &quot;name&quot;: &quot;Debian&quot;,
            &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;
        },
        {
            &quot;guid&quot;: &quot;{c6eaf9f4-32a7-5fdc-b5cf-066e8a4b1e40}&quot;,
            &quot;hidden&quot;: false,
            &quot;name&quot;: &quot;Ubuntu-18.04&quot;,
            &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;,
            // personnalisation
            &quot;acrylicOpacity&quot;: 0.9,
            &quot;antialiasingMode&quot;: &quot;cleartype&quot;,
            &quot;colorScheme&quot;: &quot;Solarized Dark&quot;,
            &quot;cursorColor&quot;: &quot;#FFFFFD&quot;,
            &quot;fontFace&quot;: &quot;Cascadia Code PL&quot;,
            &quot;suppressApplicationTitle&quot;: true,
            &quot;useAcrylic&quot;: true  
        },
        {
            &quot;guid&quot;: &quot;{07b52e3e-de2c-5db4-bd2d-ba144ed6c273}&quot;,
            &quot;hidden&quot;: false,
            &quot;name&quot;: &quot;Ubuntu-20.04&quot;,
            &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;,
            // personnalisation
            &quot;acrylicOpacity&quot;: 0.9,
            &quot;antialiasingMode&quot;: &quot;cleartype&quot;,
            &quot;colorScheme&quot;: &quot;One Half Dark&quot;,
            &quot;cursorColor&quot;: &quot;#FFFFFD&quot;,
            &quot;fontFace&quot;: &quot;Cascadia Code PL&quot;,
            &quot;suppressApplicationTitle&quot;: true,
            &quot;useAcrylic&quot;: true
        }

    ]
},
</code></pre></div> </p> </details> <p>Et j'ai commenté la partie correspondant au shell Azure.</p> <hr> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">#</a></h2> <p>Il arrive souvent que l'on rencontre des soucis à utiliser l'outillage géomatique libre sous Windows et les solutions existantes peuvent ne pas être adaptées au besoin (lire notre <a href=/articles/2020/2020-07-03_deploy_qgis_windows/ >article sur les possibilités d'automatisation de l'installateur OSGeo4W</a>). S'il ne faut pas oublier que WSL est pensé pour le développement et le test, on a pu voir que c'est une alternative souple et solide à la fois (&copy; <a href="https://www.youtube.com/watch?v=TpRNInscPdE">Les Inconnus</a>).</p> <p>Pourquoi alors ne pas imaginer déployer <a href=https://docs.microsoft.com/fr-fr/windows/wsl/build-custom-distro>une distribution personnalisée</a> comme l'<a href=https://live.osgeo.org/ >OSGeo Live</a> via le Windows Store ?</p> <p><img alt="OSGeo Live 13" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/articles-blog-rdp/capture-ecran/osgeolive_menu_v13.png title="Menu de l'OSGeo Live 13"></p> <hr> <h2 id=auteurs>Auteurs<a class=headerlink href=#auteurs title="Permanent link">#</a></h2> <h1 id=julien-moura>Julien Moura<a class=headerlink href=#julien-moura title="Permanent link">#</a></h1> <p><img alt="Portrait Julien Moura" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/internal/contributeurs/jmou.jfif title="Portrait Julien Moura"></p> <p>Géographe "sigiste" de formation, j'ai d'abord travaillé sur différentes thématiques et types de structures : la gestion des déchets en milieu urbain à Madagascar, le foncier d'intérêt général auprès de <a href=http://www.epf-reunion.com/ >l'EPF de La Réunion</a>, l'organisation et la résilience urbaine face aux risques naturels à Lima pour l'IRD.</p> <p>C'est en m'intéressant à la gouvernance et à l'ouverture des données géographiques que je travaille à <a href=https://www.isogeo.com>Isogeo</a> quelques années. L'occasion d'asseoir mes compétences en développement et gestion de produit informatique. En 2020, je deviens indépendant (In Geo Veritas) puis rejoins les rangs d'<a href=https://oslandia.com/ >Oslandia</a>.</p> <p>Féru des dynamiques de contributions, je participe activement à Geotribu depuis fin 2011 et, comme ça me manquait trop, j'ai décidé de lancer sa renaissance en 2020.</p> </div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>