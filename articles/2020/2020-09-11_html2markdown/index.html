<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2020/2020-09-11_html2markdown/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>Du HTML en Markdown (et vice-versa) - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li class=active> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../2020-09-20_tutorial_aerialod/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../2020-09-09_geodatadays/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#vers-la-simplification-de-la-contribution-le-choix-du-markdown>Vers la simplification de la contribution : le choix du Markdown</a></li> <li><a href=#introduction>Introduction</a></li> <li><a href=#markdown-lingua-franca-du-contenu-editorial-en-ligne>Markdown, lingua franca du contenu éditorial en ligne</a></li> <li><a href=#du-html-au-markdown>Du HTML au Markdown</a></li> <li><a href=#la-conversion-par-lexemple-rendre-lisible-un-article-du-cnig>La conversion par l'exemple : rendre lisible un article du CNIG</a></li> <li><a href=#conclusion>Conclusion</a></li> <li><a href=#auteur>Auteur</a></li> <li class="main "><a href=#julien-moura>Julien Moura</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=vers-la-simplification-de-la-contribution-le-choix-du-markdown>Vers la simplification de la contribution : le choix du Markdown<a class=headerlink href=#vers-la-simplification-de-la-contribution-le-choix-du-markdown title="Permanent link">#</a></h1> <p>:calendar: Date de publication initiale : 14 septembre 2020</p> <p><strong>Mots-clés :</strong> Python | Markdown | Beautifulsoup</p> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">#</a></h2> <p>Dans le cadre de la série d'articles sur la renaissance de Geotribu (lire la <a href=../2020-08-31_geotribu_histoire/ >petite histoire de Geotribu</a>), on a vu comment <a href=../2020-09-08_web-scraping_scrapy_geotribu/ >utiliser le web-scraping pour récupérer les anciens contenus</a> depuis une sauvegarde locale ou l'<a href=https://archive.org>Internet Archive</a>.</p> <p>Après cela, on a donc un beau cocktail <em>Web on The Beach</em> : HTML + CSS + JavaScript :cocktail:.</p> <p align=middle><img alt="cocktail Gatsby" loading=lazy src=https://cdn.geotribu.fr/img/articles-blog-rdp/divers/gif_cocktail_gatsby.webp title="Il est frais mon cocktail Web on the Beach, il est frais !"></p> <p>C'est bien beau mais, à part réinstaller un Drupal avec le bon modèle de BDD, on en tirera pas grand chose. Et puis ce qui nous intéresse vraiment, le nectar de Geotribu c'est le contenu rédactionnel : le texte, les images, les bouts de code, les vidéos, etc. Or, la structure, les scripts et les mécanismes de rendu (CSS...) sont encore trop intimement liés.</p> <p>Dans cet article, on va voir pourquoi et comment on a choisi de passer sur une rédaction en Markdown. Au passage, on se refait un coup de web-scraping histoire d'enfoncer le clou :hammer:.</p> <hr> <h2 id=markdown-lingua-franca-du-contenu-editorial-en-ligne>Markdown, lingua franca du contenu éditorial en ligne<a class=headerlink href=#markdown-lingua-franca-du-contenu-editorial-en-ligne title="Permanent link">#</a></h2> <p><img alt="logo markdown" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/logos-icones/markdown.png></p> <p>Inspiré par le <em>plain-text email</em> (<a href=https://fr.wikipedia.org/wiki/Texte_brut#Texte_brut_dans_un_courriel>texte brut dans un courriel en bon français</a>) ou encore le <a href=https://fr.wikipedia.org/wiki/ >ReStructuredText</a> (RST), la syntaxe <a href=https://fr.wikipedia.org/wiki/Markdown>Markdown</a> est conçue pour être facile à lire, à écrire et à convertir, tout en prenant soin de ne pas casser les balises du HTML.</p> <p>Cette dernière caractéristique est essentielle puisque cela a facilité l'intégration de la syntaxe dans de nombreux formulaires webs ou services. Très utilisée par les développeurs pour les documentations, elle est désormais très intégrée dans les milieux professionnels et y compris grand public : Slack, WordPress, etc. Certains services, tels <a href=https://markdown-here.com/features.html>Markdown Here</a>, allant jusqu'à proposer de l'utiliser pour améliorer la rédaction des emails. Du côté universitaire, la syntaxe est également très répandue :</p> <ul> <li>d'une part en étant quasiment un pré-requis pour les <a href=https://jupyter.org/ >notebooks Jupyter</a></li> <li>d'autre part car elle permet d'intégrer LateX et les syntaxes scientifiques. Exemple : <a href=https://upmath.me/ >https://upmath.me/</a>.</li> </ul> <p>Bref, au revoir <a href=https://fr.wikipedia.org/wiki/BBCode>BBCode</a>, DokuWiki, <a href=https://fr.wikipedia.org/wiki/Wikitexte>WikiTexte</a>, etc. Bonjour <a href=https://fr.wikipedia.org/wiki/Markdown>Markdown</a> :</p> <p><a data-mediabox=ligthbox-gallery data-title="Exemple basiques de la syntaxe markdown rendue dans StackEdit." href=https://cdn.geotribu.fr/img/internal/contribution/markdown_exemple.png><img alt="markdown exemple" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/internal/contribution/markdown_exemple.png title="Exemple basique de la syntaxe markdown"></a></p> <h3 id=une-syntaxe-des-rendus>Une syntaxe, des rendus<a class=headerlink href=#une-syntaxe-des-rendus title="Permanent link">#</a></h3> <p>A l'instar de n'importe quelle langue, qui plus est non standardisée, le rendu HTML du Markdown dépend de l'implémentation qui en est faite : technologie, finalité et philosophie du processus de conversion, etc. Ainsi, il y aura des différences à l'affichage ou au traitement.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Pour ne pas dupliquer ici du contenu existant, je vous renvoie vers l'article <a href=/contribuer/build_site/markdown_engine/ >Comprendre et tester le moteur de rendu du site</a>.</p> </div> <hr> <h2 id=du-html-au-markdown>Du HTML au Markdown<a class=headerlink href=#du-html-au-markdown title="Permanent link">#</a></h2> <p><img alt=mouton class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/logos-icones/divers/mouton.jpg title=Bêêêêê></p> <p>Revenons à nos géo-moutons.</p> <p>Une fois le HTML et les ressources liées (images...) récupérés de Geotribu, j'ai opté pour un stockage sous forme de Markdown. Pour cela, j'ai utilisé le package <a href=https://github.com/matthewwithanm/python-markdownify>markdownify</a> qui permet de transformer du HTML en Markdown.</p> <p>Vu qu'on a déjà passé un article sur le projet Scrapy utilisé pour récupérer les anciens contenus depuis l'Internet Archive, je ne vais pas de nouveau détailler le <a href=/articles/2020/2020-09-08_web-scraping_scrapy_geotribu/ ><em>pipeline</em></a> mais plutôt démontrer comment appliquer la même mécanique facilement :</p> <ol> <li>aspirer un site web avec du web-scraping</li> <li>traiter le HTML pour décortiquer le contenu :<ul> <li>extraire le texte et les styles du HTML &rarr; transformer en Markdown</li> <li>extraire les medias statiques (images, etc.) pour les stocker dans un espace tiers (CDN)</li> </ul> </li> </ol> <h2 id=la-conversion-par-lexemple-rendre-lisible-un-article-du-cnig>La conversion par l'exemple : rendre lisible un article du CNIG<a class=headerlink href=#la-conversion-par-lexemple-rendre-lisible-un-article-du-cnig title="Permanent link">#</a></h2> <p>L'usage de <em>markdownify</em> est simple. Pour s'en rendre compte, testons cela rapidement avec un petit objectif pour l'occasion : transformer en markdown <a href="http://cnig.gouv.fr/?p=23807">le dernier article du site du CNIG</a> pour le lire sans saigner des yeux.</p> <p>Au passage, on en profite pour essayer deux autres bibliothèques pour ce genre de cas de figure :</p> <ul> <li><a href=https://www.crummy.com/software/BeautifulSoup/ >Beautifulsoup</a> : pour le parsing du HTML</li> <li><a href=https://urllib3.readthedocs.io/ >urllib3</a> : pour facilement faire des requêtes HTTP ; <em>requests</em> ou <em>httpx</em> étant surdimensionnés pour notre besoin, mais avec la flemme de gérer les détails (décodage, etc.)</li> </ul> <h3 id=structure>Structure<a class=headerlink href=#structure title="Permanent link">#</a></h3> <p>En regardant <a href="view-source:http://cnig.gouv.fr/?p=23807">les sources de l'article</a>, on sait que le contenu intéressant est dans la div de class <code>post-content</code> :</p> <p><a data-mediabox=scraping data-title="Sources d'un article du site du CNIG." href=https://cdn.geotribu.fr/img/tuto/webscraping/scraping_cnig_art_source.png><img alt="Source HTML CNIG" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/webscraping/scraping_cnig_art_source.png title="Les sources de l'article du CNIG"></a></p> <h3 id=prerequis>Prérequis<a class=headerlink href=#prerequis title="Permanent link">#</a></h3> <p>Avant de commencer, on installe ce qu'il nous manque :</p> <div class=highlight><pre><span></span><code>python -m pip install <span class=nv>beautifulsoup4</span><span class=o>==</span><span class=m>4</span>.9.* <span class=nv>markdownify</span><span class=o>==</span><span class=m>0</span>.5.2 <span class=nv>urllib3</span><span class=o>==</span><span class=m>1</span>.25.*
</code></pre></div> <h3 id=scraping-et-conversion-a-la-volee>Scraping et conversion à la volée<a class=headerlink href=#scraping-et-conversion-a-la-volee title="Permanent link">#</a></h3> <p>Puis cela tient en quelques lignes dûment commentées :</p> <div class=highlight><pre><span></span><code><span class=ch>#! python3</span>

<span class=c1># -- Imports</span>

<span class=c1># Bibliothèque standard</span>
<span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>

<span class=c1># Packages tiers</span>
<span class=kn>import</span> <span class=nn>urllib3</span>
<span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
<span class=kn>from</span> <span class=nn>markdownify</span> <span class=kn>import</span> <span class=n>markdownify</span>

<span class=c1># -- Variables</span>

<span class=n>in_url</span> <span class=o>=</span> <span class=s2>&quot;http://cnig.gouv.fr/?p=23807&quot;</span>
<span class=n>out_filepath</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=s2>&quot;./cnig_23807.md&quot;</span><span class=p>)</span>

<span class=c1># -- Programme principal</span>

<span class=c1># d&#39;abord on télécharge la page</span>
<span class=n>http</span> <span class=o>=</span> <span class=n>urllib3</span><span class=o>.</span><span class=n>PoolManager</span><span class=p>()</span>
<span class=n>page</span> <span class=o>=</span> <span class=n>http</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=n>in_url</span><span class=p>)</span>

<span class=c1># on parse le html</span>
<span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>page</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=s2>&quot;html.parser&quot;</span><span class=p>)</span>

<span class=c1># on extrait ce qu&#39;il y a dans la classe post-content</span>
<span class=n>post_content</span> <span class=o>=</span> <span class=n>soup</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&quot;div&quot;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&quot;class&quot;</span><span class=p>:</span> <span class=s2>&quot;post-content&quot;</span><span class=p>})</span>

<span class=c1># on transforme en markdown en spécifiant le style de titre avec des &#39;#&#39;</span>
<span class=n>out_md</span> <span class=o>=</span> <span class=n>markdownify</span><span class=p>(</span><span class=n>post_content</span><span class=p>,</span> <span class=n>heading_style</span><span class=o>=</span><span class=s2>&quot;ATX&quot;</span><span class=p>,</span> <span class=n>autolinks</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>

<span class=c1># on écrit notre fichier</span>
<span class=k>with</span> <span class=n>out_filepath</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;UTF8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fifi</span><span class=p>:</span>
    <span class=n>fifi</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>out_md</span><span class=p>)</span>
</code></pre></div> <p>Le résultat, ainsi que le code, sont disponibles dans <a href=https://gist.github.com/Guts/a77e9e378b7157f568077ab47937a9d9>ce gist</a>.</p> <hr> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">#</a></h2> <p>Evidemment, le résultat est loin d'être parfait et cela demande quelques ajustements et améliorations : déterminer le nom du fichier selon le titre de la page, nettoyer les espacements avant les paragraphes, etc. D'ailleurs, ce nettoyage manuel est toujours en cours pour une partie des contenus de Geotribu.</p> <p>Cela démontre bien à la fois la faisabilité et les limitations du traitement automatisé, qu'on peut résumer ainsi :</p> <div class=mermaid>graph TD; A[Site archivé]--&gt;B[Scraping]; B--&gt;C[HTML]; B--&gt;D[Images]; C--&gt;E[Markdown]; D--&gt;F[CDN];</div> <p align=middle><a href=/articles/2020/2020-12-30_deployer_geotribu_a_la_maison/ class=md-button>Suite : déployer le site de Geotribu sur son ordinateur :fontawesome-solid-step-forward:</a></p> <hr> <h2 id=auteur>Auteur<a class=headerlink href=#auteur title="Permanent link">#</a></h2> <h1 id=julien-moura>Julien Moura<a class=headerlink href=#julien-moura title="Permanent link">#</a></h1> <p><img alt="Portrait Julien Moura" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/internal/contributeurs/jmou.jfif title="Portrait Julien Moura"></p> <p>Géographe "sigiste" de formation, j'ai d'abord travaillé sur différentes thématiques et types de structures : la gestion des déchets en milieu urbain à Madagascar, le foncier d'intérêt général auprès de <a href=http://www.epf-reunion.com/ >l'EPF de La Réunion</a>, l'organisation et la résilience urbaine face aux risques naturels à Lima pour l'IRD.</p> <p>C'est en m'intéressant à la gouvernance et à l'ouverture des données géographiques que je travaille à <a href=https://www.isogeo.com>Isogeo</a> quelques années. L'occasion d'asseoir mes compétences en développement et gestion de produit informatique. En 2020, je deviens indépendant (In Geo Veritas) puis rejoins les rangs d'<a href=https://oslandia.com/ >Oslandia</a>.</p> <p>Féru des dynamiques de contributions, je participe activement à Geotribu depuis fin 2011 et, comme ça me manquait trop, j'ai décidé de lancer sa renaissance en 2020.</p> </div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>