<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/articles/2021/2021-02-02_pyqgis_previsualiser_images_integrees/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>PyQGIS : lister et prévisualiser les images intégrées - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li class=active> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../contribuer/introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../../contribuer/requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../../contribuer/contribution_guide/ >Guide de contribution</a> </li> <li> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../2021-02-09_statistiques_twitter/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../2021-01-26_test_unfolded_studio/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#recuperer-et-previsualiser-les-icones-integrees-a-qgis>Récupérer et prévisualiser les icônes intégrées à QGIS</a></li> <li><a href=#intro>Intro</a></li> <li><a href=#lheure-du-script-a-sonne>L'heure du script a sonné</a></li> <li><a href=#conclusion>Conclusion</a></li> <li><a href=#auteur>Auteur</a></li> <li class="main "><a href=#julien-moura>Julien Moura</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=recuperer-et-previsualiser-les-icones-integrees-a-qgis>Récupérer et prévisualiser les icônes intégrées à QGIS<a class=headerlink href=#recuperer-et-previsualiser-les-icones-integrees-a-qgis title="Permanent link">#</a></h1> <p>:calendar: Date de publication initiale : 25 janvier 2021</p> <p><strong>Mots-clés :</strong> Python | QGIS | développement | plugin | interface graphique | script | Markdown</p> <p>Pré-requis :</p> <ul> <li>une connexion internet</li> <li>Python 3.7+ et les notions qui vont avec</li> </ul> <h2 id=intro>Intro<a class=headerlink href=#intro title="Permanent link">#</a></h2> <p><img alt="icône Python" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/logos-icones/programmation/python.png title="logo Python"></p> <p>Avec mon arrivée chez <a href=https://oslandia.com/ >Oslandia</a>, je me remets au développement de plugins pour QGIS alors autant partager de temps en temps quelques cas d’usage :slightly_smiling_face:. Dans <a href=/articles/2021/2021-01-19_pyqgis_utiliser_icones_integrees>l'article précédent</a>, on vous invitait à utiliser les images embarquées dans le "coeur" de QGIS pour égayer l'interface graphique de vos plugins.</p> <p>Pour trouver les icônes, je vous renvoyais sur <a href=https://github.com/qgis/QGIS/blob/master/images/images.qrc>le fichier de ressources de QGIS</a>, mais c'est vrai qu'une fois sur le fichier, c'est un peu sec !</p> <p align=middle><a data-mediabox=illustrations data-title="Comment ça, le fichier de ressources c'est pas suffisant ?" href=https://cdn.geotribu.fr/img/tuto/qgis_plugin_embedded_images/qgis_resources-qrc_github.png><img alt="fichier resources.qrc de QGIS" class=img-center loading=lazy src=https://cdn.geotribu.fr/img/tuto/qgis_plugin_embedded_images/qgis_resources-qrc_github.png title="fichier resources.qrc de QGIS"></a> <em>Comment ça, le fichier de ressources c'est pas suffisant ?</em></p> <p>Dans cet article, je vous propose de générer une page HTML dans laquelle on liste et on prévisualise les images intégrées.</p> <p align=middle><a class=md-button href=#__comments>Commenter cet article :fontawesome-solid-comments:</a></p> <h2 id=lheure-du-script-a-sonne>L'heure du script a sonné<a class=headerlink href=#lheure-du-script-a-sonne title="Permanent link">#</a></h2> <p>Voici comment on va procéder dans un script qu'on va nommer <code>qrc_preview_in_md.py</code>:</p> <ol> <li>Télécharger le fichier <code>images/images.qrc</code> depuis le dépôt de QGIS</li> <li>Lire le fichier pour en extraire les informations sur les images</li> <li>Classer les informations et structurer la donnée en sortie</li> <li>Générer un fichier Markdown qu'on pourra ainsi facilement intégrer dans un site web (documentation ou celui de Geotribu :wink:)</li> </ol> <p>On se donne quelques contraintes pour pimenter un peu :</p> <ul> <li>portabilité : on n'utilise que la bibliothèque standard de Python (<a href=https://docs.python.org/3/library/index.html>PSL la bien nommée</a>), histoire de pouvoir faire tourner facilement le script sans gérer de dépendances.</li> <li>légèreté et rapidité : ne pas télécharger l'intégralité du projet QGIS, ni même les images.</li> </ul> <h3 id=telecharger-le-fichier>Télécharger le fichier<a class=headerlink href=#telecharger-le-fichier title="Permanent link">#</a></h3> <p><img alt="icône browser QGIS" class=img-rdp-news-thumb src=https://raw.githubusercontent.com/qgis/QGIS/master/images/icons/qbrowser_icon.svg title="Icône browser QGIS"></p> <p>Pour cette étape, on démarre sereinement : le fichier est sur GitHub qui supporte parfaitement les requêtes anonymes et il n'y a pas vraiment de difficulté.</p> <div class=highlight><pre><span></span><code><span class=c1># on importe de quoi faire des requêtes HTTP</span>
<span class=kn>from</span> <span class=nn>urllib.request</span> <span class=kn>import</span> <span class=n>urlopen</span>

<span class=c1># on stocke l&#39;URL en variable. Sait-on jamais, on pourrait vouloir pointer sur d&#39;autres fichiers ;)</span>
<span class=n>resources_url</span> <span class=o>=</span> <span class=s2>&quot;https://raw.githubusercontent.com/qgis/QGIS/master/images/images.qrc&quot;</span>

<span class=c1># on télécharge dans un fichier localement</span>
<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;qgis_resources.qrc&quot;</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>local_qrc_file</span><span class=p>:</span>
    <span class=k>with</span> <span class=n>urlopen</span><span class=p>(</span><span class=n>resources_url</span><span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
        <span class=n>local_qrc_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</code></pre></div> <p>Quelques remarques si vous débutez en Python :</p> <ul> <li>on utilise des instructions <code>with</code> qui contextualise proprement (<code>context manager</code>) les opérations de lecture/écriture (<code>i/o</code>) en gérant proprement l'ouverture et la fermeture de la requête et du fichier</li> <li>on utilise le mode <code>wb</code> puisqu'on reçoit la réponse en binaire</li> </ul> <p>Voilà, on a donc notre fichier <code>qgis_resources.qrc</code> :</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;RCC&gt;</span>
    <span class=nt>&lt;qresource</span> <span class=na>prefix=</span><span class=s>&quot;/images&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;file</span> <span class=na>alias=</span><span class=s>&quot;last-hackfest.png&quot;</span><span class=nt>&gt;</span>splash/dev-splash.png<span class=nt>&lt;/file&gt;</span>
        <span class=nt>&lt;file&gt;</span>flags/af.svg<span class=nt>&lt;/file&gt;</span>
        <span class=nt>&lt;file&gt;</span>flags/ar.svg<span class=nt>&lt;/file&gt;</span>
        <span class=nt>&lt;file&gt;</span>flags/bg.svg<span class=nt>&lt;/file&gt;</span>
        [...]
    <span class=nt>&lt;/qresource&gt;</span>
    <span class=nt>&lt;qresource</span> <span class=na>prefix=</span><span class=s>&quot;/images/tips&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;file</span> <span class=na>alias=</span><span class=s>&quot;symbol_levels.png&quot;</span><span class=nt>&gt;</span>qgis_tips/symbol_levels.png<span class=nt>&lt;/file&gt;</span>
    <span class=nt>&lt;/qresource&gt;</span>
<span class=nt>&lt;/RCC&gt;</span>
</code></pre></div> <h3 id=lire-le-fichier-qrc>Lire le fichier QRC<a class=headerlink href=#lire-le-fichier-qrc title="Permanent link">#</a></h3> <p><img alt="icône overview QGIS" class=img-rdp-news-thumb src=https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mActionAddAllToOverview.svg title="Icône overview QGIS"></p> <p>En y regardant plus attentivement, on comprend qu'il s'agit d'un XML qui ne dit pas son nom. On a donc tout ce qu'il nous faut :</p> <div class=highlight><pre><span></span><code><span class=c1># on importe de quoi lire du XML</span>
<span class=kn>import</span> <span class=nn>xml.etree.ElementTree</span> <span class=k>as</span> <span class=nn>ET</span>

<span class=c1># on ouvre notre fichier précédemment téléchargé</span>
<span class=n>tree</span> <span class=o>=</span> <span class=n>ET</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=s2>&quot;qgis_resources.qrc&quot;</span><span class=p>)</span>
<span class=n>root</span> <span class=o>=</span> <span class=n>tree</span><span class=o>.</span><span class=n>getroot</span><span class=p>()</span>
</code></pre></div> <p>Et c'est tout ! On a chargé la strcuture de l'arbre XML. Affichons quelques informations sur les balises sous-jacentes :</p> <div class=highlight><pre><span></span><code><span class=c1># l&#39;élément racine a un tag</span>
<span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>root</span><span class=o>.</span><span class=n>tag</span><span class=p>)</span>
<span class=n>RCC</span>


<span class=c1># l&#39;élément racine n&#39;a aucun attribut</span>
<span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>root</span><span class=o>.</span><span class=n>attrib</span><span class=p>)</span>
<span class=p>{}</span>

<span class=c1># il y a 2 éléments &quot;enfants&quot; avec chacun le même tag et le même attribut</span>
<span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>([(</span><span class=n>i</span><span class=o>.</span><span class=n>tag</span><span class=p>,</span> <span class=n>i</span><span class=o>.</span><span class=n>attrib</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>root</span><span class=o>.</span><span class=n>getchildren</span><span class=p>()])</span>
<span class=p>[(</span><span class=s1>&#39;qresource&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;prefix&#39;</span><span class=p>:</span> <span class=s1>&#39;/images&#39;</span><span class=p>}),</span> <span class=p>(</span><span class=s1>&#39;qresource&#39;</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;prefix&#39;</span><span class=p>:</span> <span class=s1>&#39;/images/tips&#39;</span><span class=p>})]</span>
</code></pre></div> <p>On a donc une structure très simple :</p> <ul> <li>les éléments de deuxième niveau sont des "préfixes" correspondant au chemin vers un sous-dossier par rapport au projet principal de l'application qui utilise le fichier (ici QGIS). Il n'y en a que deux.</li> <li>les éléments de troisième niveau contiennent le chemin jusqu'aux images</li> </ul> <h3 id=extraire-le-chemin-des-images>Extraire le chemin des images<a class=headerlink href=#extraire-le-chemin-des-images title="Permanent link">#</a></h3> <p><img alt="icône filter QGIS" class=img-rdp-news-thumb src=https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mActionFilter2.svg title="Icône filter QGIS"></p> <p>Maintenant qu'on a une idée de la structure, on doit se débrouiller pour reconstituer l'URL complète vers les images, elles-aussi stockées dans le dépôt GitHub de QGIS.</p> <p>Petit point de vigilance, il faut pointer sur l'URL brute du fichier et non pas celle vers l'interface de la plateforme. Par exemple, pour cette image <img alt="icône console QGIS" src=https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/console/iconClassConsole.svg title="Icône console Python QGIS"> :</p> <ul> <li>:no_entry: le lien de l'interface GitHub : <a href=https://github.com/qgis/QGIS/blob/master/images/themes/default/console/iconClassConsole.svg>https://github.com/qgis/QGIS/blob/master/images/themes/default/console/iconClassConsole.svg</a></li> <li>:white_check_mark: le lien de l'image brute : <a href=https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/console/iconClassConsole.svg>https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/console/iconClassConsole.svg</a></li> </ul> <p>Le chemin complet d'une image est donc la somme de 3 éléments :</p> <ul> <li>l'<a href=https://raw.githubusercontent.com/qgis/QGIS/master/ >URL brute de base du dépôt QGIS</a></li> <li>l'attribut du préfixe de chaque élément <code>&lt;qresource&gt;</code></li> <li>la valeur textuelle de chaque élément <code>&lt;file&gt;&lt;/file&gt;</code></li> </ul> <p>C'est partiiii :rocket: :</p> <div class=highlight><pre><span></span><code><span class=c1># on importe l&#39;outillage de manipulation des chemins et des URLs</span>
<span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
<span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>urljoin</span>

<span class=c1># on stocke l&#39;URL de base pour construire les chemins</span>
<span class=n>base_path</span> <span class=o>=</span> <span class=s2>&quot;https://raw.githubusercontent.com/qgis/QGIS/master/&quot;</span>  <span class=c1># avec le final slash :vegeta:</span>

<span class=c1># on boucle sur les préfixes</span>
<span class=k>for</span> <span class=n>prefix</span> <span class=ow>in</span> <span class=n>root</span><span class=p>:</span>
    <span class=c1># là on est dans un élément de niveau 2</span>
    <span class=n>prefix_name</span> <span class=o>=</span> <span class=n>prefix</span><span class=o>.</span><span class=n>attrib</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;prefix&quot;</span><span class=p>)[</span><span class=mi>1</span><span class=p>:]</span>           <span class=c1># on garde le préfixe mais sans son slash initial</span>

    <span class=c1># on boucle sur les fichiers</span>
    <span class=k>for</span> <span class=n>binimg</span> <span class=ow>in</span> <span class=n>prefix</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s2>&quot;file&quot;</span><span class=p>):</span>
        <span class=c1># là on est dans un élément de niveau 3</span>
        <span class=c1># on construit l&#39;URL absolue</span>
        <span class=n>img_path_abs</span> <span class=o>=</span> <span class=n>urljoin</span><span class=p>(</span><span class=n>base_path</span><span class=p>,</span>  <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>binimg</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=c1># un petit print des familles histoire pouvoir vérifier les liens</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>img_path_abs</span><span class=p>)</span>
</code></pre></div> <p>On obtient quelque chose comme ça :</p> <div class=highlight><pre><span></span><code>https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/temporal_navigation/pause.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mIconIterate.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mIconNetworkLogger.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mActionAddMarker.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mLayoutItemMarker.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/algorithms/mAlgorithmConstantRaster.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mIconStopwatch.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/georeferencer/mGeorefRun.png
<span class=o>[</span>...<span class=o>]</span>
https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/console/iconSyntaxErrorConsoleParams.svg
https://raw.githubusercontent.com/qgis/QGIS/master/images/tips/qgis_tips/symbol_levels.png
$
</code></pre></div> <p>On remarque d'abord que les liens fonctionnent bien. Mais ça n'est pas très bien rangé et ce serait dommage de pas avoir les images rangées selon leurs dossiers dans notre document final.</p> <p>Pour corriger cela, on applique une méthode de tri sur la liste des éléments <code>file</code> :</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=n>binimg</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>prefix</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s2>&quot;file&quot;</span><span class=p>),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]):</span>
    <span class=n>img_path_abs</span> <span class=o>=</span> <span class=n>urljoin</span><span class=p>(</span><span class=n>base_path</span><span class=p>,</span>  <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>binimg</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>img_path_abs</span><span class=p>)</span>
</code></pre></div> <p>C'est beaucoup mieux ! Maintenant, mettons cela en forme dans du Markdown.</p> <h3 id=mise-en-forme-markdown>Mise en forme Markdown<a class=headerlink href=#mise-en-forme-markdown title="Permanent link">#</a></h3> <p><img alt="icône digitizing QGIS" class=img-rdp-news-thumb src=https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/propertyicons/digitizing.svg title="Icône digitizing QGIS"></p> <p>Pour cette étape, on va stocker le texte dans une variable qu'on incrémentera avec les liens formatés au fur et à mesure de nos boucles, avant d'enregistrer le tout dans un fichier. Histoire d'avoir quelque chose de lisible, on met ça dans un tableau de 2 colonnes : nom du fichier et prévisualiation.</p> <p>Voici le code qu'on insère avant nos boucles :</p> <div class=highlight><pre><span></span><code><span class=c1># donnons un doux nom à notre variable</span>
<span class=n>out_markdown</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>

<span class=c1># on ajoute un titre à la page</span>
<span class=n>out_markdown</span> <span class=o>+=</span> <span class=s2>&quot;&quot;&quot;# Mémo pratique sur les images intégrées dans QGIS</span><span class=se>\n\n</span><span class=s2>&quot;&quot;&quot;</span>

<span class=c1># on ajoute l&#39;entête de notre tableau</span>
<span class=n>out_markdown</span> <span class=o>+=</span> <span class=s2>&quot;| Nom du fichier | Prévisualisation |</span><span class=se>\n</span><span class=s2>| :----- | ------- |</span><span class=se>\n</span><span class=s2>&quot;</span>
</code></pre></div> <p>Celui que l'on insère dans la boucle pour ajouter une ligne pour chaque image:</p> <div class=highlight><pre><span></span><code><span class=p>[</span><span class=o>...</span><span class=p>]</span>
<span class=k>for</span> <span class=n>binimg</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>prefix</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s2>&quot;file&quot;</span><span class=p>),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]):</span>
    <span class=n>img_path_abs</span> <span class=o>=</span> <span class=n>urljoin</span><span class=p>(</span><span class=n>base_path</span><span class=p>,</span>  <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>binimg</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=n>img_path_rel</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>prefix_name</span><span class=p>,</span> <span class=n>binimg</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>

    <span class=c1># on crée le modèle de chaque ligne qu&#39;on pourra ainsi utiliser avec le formatage dynamique des chaînes de caractères</span>
    <span class=n>out_markdown</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;| </span><span class=si>{</span><span class=n>img_path_rel</span><span class=o>.</span><span class=n>stem</span><span class=si>}</span><span class=s2> | ![</span><span class=si>{</span><span class=n>img_path_rel</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>](</span><span class=si>{</span><span class=n>img_path_abs</span><span class=si>}</span><span class=s2> &#39;</span><span class=si>{</span><span class=n>img_path_rel</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;) |</span><span class=se>\n</span><span class=s2>&quot;</span>
</code></pre></div> <p>Et celui qu'on insère à la fin pour sauvegarder tout cela dans un fichier avec l'extension du Markdown :</p> <div class=highlight><pre><span></span><code><span class=c1># donnons un doux nom à notre variable</span>
<span class=k>with</span> <span class=n>Path</span><span class=p>(</span><span class=s2>&quot;qgis_resources_preview_table.md&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>io_out</span><span class=p>:</span>
    <span class=n>io_out</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>out_markdown</span><span class=p>)</span>
</code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">#</a></h2> <p><img alt="icône feature attribute table QGIS" class=img-rdp-news-thumb src=https://raw.githubusercontent.com/qgis/QGIS/master/images/themes/default/mActionCalculateField.svg title="Icône feature attribute table QGIS"></p> <p>Nous voici avec notre joli fichier que l'on peut <a href=/contribuer/build_site/markdown_engine/ >convertir en HTML par exemple</a>. D'ailleurs, j'en ai profité pour l'intégrer à notre site (cf bouton plus bas). A garder sous le coude pour avoir les images et leurs chemins pour développer des plugins colorés.</p> <p>Pour les plus curieux, j'ai stocké le script complet et avec quelques optimisations dans un Gist dont le lien est également en bas de page. Enfin, tout ça m'a aussi permis d'utiliser les icônes de QGIS pour illustrer les parties de ce tutoriel.</p> <p align=middle><a href=/toc_nav_ignored/qgis_resources_preview_table/ class=md-button>Afficher le rendu final :fontawesome-regular-eye:</a> <a class=md-button href=https://gist.github.com/Guts/47448dd1c112f5afe28adedd047caf61#file-qrc_preview_in_md-py>Consulter le script finalisé :fontawesome-brands-github-alt:</a></p> <hr> <h2 id=auteur>Auteur<a class=headerlink href=#auteur title="Permanent link">#</a></h2> <h1 id=julien-moura>Julien Moura<a class=headerlink href=#julien-moura title="Permanent link">#</a></h1> <p><img alt="Portrait Julien Moura" class=img-rdp-news-thumb src=https://cdn.geotribu.fr/img/internal/contributeurs/jmou.jfif title="Portrait Julien Moura"></p> <p>Géographe "sigiste" de formation, j'ai d'abord travaillé sur différentes thématiques et types de structures : la gestion des déchets en milieu urbain à Madagascar, le foncier d'intérêt général auprès de <a href=http://www.epf-reunion.com/ >l'EPF de La Réunion</a>, l'organisation et la résilience urbaine face aux risques naturels à Lima pour l'IRD.</p> <p>C'est en m'intéressant à la gouvernance et à l'ouverture des données géographiques que je travaille à <a href=https://www.isogeo.com>Isogeo</a> quelques années. L'occasion d'asseoir mes compétences en développement et gestion de produit informatique. En 2020, je deviens indépendant (In Geo Veritas) puis rejoins les rangs d'<a href=https://oslandia.com/ >Oslandia</a>.</p> <p>Féru des dynamiques de contributions, je participe activement à Geotribu depuis fin 2011 et, comme ça me manquait trop, j'ai décidé de lancer sa renaissance en 2020.</p> </div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>