<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=description content="Site indépendant de veille sur la géomatique libre et open source. Articles, tutoriels et revues de presse (#GeoRDP) sur l'information géographique, les SIG, la cartographie, la représentation des données..."><meta name=author content=Geotribu><link href=https://static.geotribu.fr/contribuer/edit/local_edition_setup/ rel=canonical><link rel="shortcut icon" href=../../../img/favicon.ico><title>Configurer l'environnement pour l'édition en local - Geotribu</title><link href=../../../css/bootstrap.min.css rel=stylesheet><link href=../../../css/font-awesome.min.css rel=stylesheet><link href=../../../css/bootstrap-theme.min.css rel=stylesheet><link href=../../../../../../theme/assets/stylesheets/extra.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.css rel=stylesheet><!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]--><script src=../../../js/jquery-1.10.2.min.js></script><script src=../../../js/bootstrap.min.js></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'None', 'auto');
            ga('send', 'pageview');
        </script></head> <body> <div class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=container> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=../../..>Geotribu</a> </div> <div class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li> <a href=../../..>&#127968; Accueil</a> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Revues de presse <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2017</a> </li> <li> <a href=../../..>2016</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>Articles <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../..>2021</a> </li> <li> <a href=../../..>2020</a> </li> <li> <a href=../../..>2015</a> </li> <li> <a href=../../..>2014</a> </li> <li> <a href=../../..>2013</a> </li> <li> <a href=../../..>2012</a> </li> <li> <a href=../../..>2011</a> </li> <li> <a href=../../..>2010</a> </li> <li> <a href=../../..>2009</a> </li> <li> <a href=../../..>2008</a> </li> </ul> </li> <li class="dropdown active"> <a href=# class=dropdown-toggle data-toggle=dropdown>Contribuer <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../introduction/ >Contribuer à Geotribu</a> </li> <li> <a href=../../requirements/ >Prérequis pour la contribution</a> </li> <li> <a href=../../contribution_guide/ >Guide de contribution</a> </li> <li class=active> <a href=../../..>Editer le contenu</a> </li> <li> <a href=../../..>Générer le site web</a> </li> <li> <a href=../../..>Guides de rédaction</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> <li class=dropdown> <a href=# class=dropdown-toggle data-toggle=dropdown>A propos <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href=../../../team/ >L'équipe Geotribu</a> </li> <li> <a href=../../../team/acha/ >Aurélien Chaumet</a> </li> <li> <a href=../../../team/avdc/ >Arnaud Vandecasteele</a> </li> <li> <a href=../../../team/avha/ >Adrien Van Hamme</a> </li> <li> <a href=../../../team/edel/ >Etienne Delay</a> </li> <li> <a href=../../../team/fbor/ >Florian Boret</a> </li> <li> <a href=../../../team/fgob/ >Fabien Goblet</a> </li> <li> <a href=../../../team/gdbo/ >Guillaume de Boyer</a> </li> <li> <a href=../../../team/jmou/ >Julien Moura</a> </li> <li> <a href=../../../team/jory/ >Jérémie Ory</a> </li> <li> <a href=../../../team/jpie/ >Julie Pierson</a> </li> <li> <a href=../../../team/mraj/ >Mathieu Rajerison</a> </li> <li> <a href=../../../team/pver/ >Pierre Vernier</a> </li> <li> <a href=../../../team/rbov/ >Rémi Bovard</a> </li> <li> <a href=../../../team/rqui/ >Rodolphe Quiédeville</a> </li> <li> <a href=../../../team/tgra/ >Thomas Gratier</a> </li> <li> <a href=../../..>Archives</a> </li> </ul> </li> </ul> <ul class="nav navbar-nav navbar-right"> <li> <a href=../fix_content_from_website/ rel=next> <i class="fa fa-arrow-left"></i> Previous </a> </li> <li> <a href=../../build_site/markdown_engine/ rel=prev> Next <i class="fa fa-arrow-right"></i> </a> </li> <li> <a href=https://github.com/geotribu/website/ > geotribu/website </a> </li> </ul> </div> </div> </div> <div class=container> <div class=row> <div class=col-md-3><div class="bs-sidebar hidden-print affix well" role=complementary> <ul class="nav bs-sidenav"> <li class="main active"><a href=#installation-pour-ledition-locale>Installation pour l'édition locale</a></li> <li><a href=#git>Git</a></li> <li><a href=#python>Python</a></li> <li><a href=#pre-commit>Pre-commit</a></li> <li><a href=#servir-en-local>Servir en local</a></li> <li><a href=#mettre-a-jour-son-depot-local>Mettre à jour son dépôt local</a></li> </ul> </div></div> <div class=col-md-9 role=main> <h1 id=installation-pour-ledition-locale>Installation pour l'édition locale<a class=headerlink href=#installation-pour-ledition-locale title="Permanent link">#</a></h1> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Remplir d'abord <a href=../../requirements>les prérequis</a>. Les chemins de fichiers et répertoires sont à adapter à votre environnement.</p> </div> <h2 id=git>Git<a class=headerlink href=#git title="Permanent link">#</a></h2> <p>La mise en ligne du contenu se fait via <a href=https://git-scm.com/download/ >Git</a>. Si vous n'êtes pas à l'aise avec la ligne de commande, il est possible d'utiliser <a href=https://desktop.github.com/ >GitHub Desktop</a>.</p> <p>Cloner le dépôt, soit avec la commande ci-dessous, soit via <a href=https://github.com/geotribu/website>le bouton vert sur le dépôt avec GitHub Desktop</a> :</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span> ~/git-repos/geotribu/
git clone https://github.com/geotribu/website.git
</code></pre></div> <hr> <h2 id=python>Python<a class=headerlink href=#python title="Permanent link">#</a></h2> <p>Pour éditer localement et visualiser le résultat final avant de publier sur le dépôt, il faut installer <a href=https://docs.python.org/fr/3/tutorial/ >Python</a> 3.7 ou supérieure et les dépendances du projet. Exemple avec Ubuntu 18. 04 et Windows 10 (quelques adaptations peuvent être nécessaires):</p> <div class=tabbed-set data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Bash</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=c1># se rendre à la racine du dépôt local - adapter à son environnement</span>
<span class=nb>cd</span> ~/git-repos/geotribu/website/

<span class=c1># lister les versions de Python installées</span>
ls -1 /usr/bin/python* <span class=p>|</span> grep <span class=s1>&#39;[2-3].[0-9]$&#39;</span>

<span class=c1># si aucune version supérieure ou égale à 3.7 n&#39;est installée, installons la dernière</span>
sudo apt install python3.8

<span class=c1># créer un environnement virtuel</span>
python3.8 -m venv .venv
<span class=nb>source</span> .venv/bin/activate

<span class=c1># mettre à jour pip et les outils de packaging</span>
pip install -U pip setuptools wheel

<span class=c1># installer les dépendances</span>
python -m pip install -U -r requirements.txt
</code></pre></div> </div> <input id=__tabbed_1_2 name=__tabbed_1 type=radio><label for=__tabbed_1_2>Powershell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=c># se rendre à la racine du dépôt local - adapter à son environnement</span>
<span class=nb>cd </span><span class=p>~/</span><span class=n>git-repos</span><span class=p>/</span><span class=n>geotribu</span><span class=p>/</span><span class=n>website</span><span class=p>/</span>

<span class=c># si besoin, autoriser l&#39;utilisation des environnements virtuels</span>
<span class=c># commande à exécuter dans Powershell en mode administrateur (puis quitter le mode admin avant de continuer)</span>
<span class=nb>Set-ExecutionPolicy</span> <span class=n>-ExecutionPolicy</span> <span class=n>RemoteSigned</span> <span class=n>-Scope</span> <span class=n>CurrentUser</span>

<span class=c># lister les versions de Python installées</span>
<span class=n>py</span> <span class=p>-</span><span class=n>-list</span>

<span class=c># créer un environnement virtuel</span>
<span class=n>py</span> <span class=p>-</span><span class=n>3</span><span class=p>.</span><span class=n>7</span> <span class=n>-m</span> <span class=n>venv</span> <span class=p>.</span><span class=n>venv</span>   <span class=c># attention ne fonctionne pas avec Python installé depuis le Windows Store</span>

<span class=c># activer l&#39;environnement virtuel</span>
<span class=p>.\.</span><span class=n>venv</span><span class=p>\</span><span class=n>Scripts</span><span class=p>\</span><span class=n>activate</span>

<span class=c># mettre à jour pip</span>
<span class=n>python</span> <span class=n>-m</span> <span class=n>pip</span> <span class=n>install</span> <span class=n>-U</span> <span class=n>pip</span>

<span class=c># installer les dépendances</span>
<span class=n>python</span> <span class=n>-m</span> <span class=n>pip</span> <span class=n>install</span> <span class=n>-U</span> <span class=n>-r</span> <span class=n>requirements</span><span class=p>.</span><span class=n>txt</span>
</code></pre></div> </div> </div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Le projet est configuré pour mettre semi-automatiquement à jour certaines dépendances. Il est donc recommandé de mettre son environnement virtuel local à jour avant de contribuer : <code>pip install -U -r requirements.txt</code>.</p> </div> <hr> <h2 id=pre-commit>Pre-commit<a class=headerlink href=#pre-commit title="Permanent link">#</a></h2> <p>Le projet vient avec une <a href=https://github.com/geotribu/website/blob/master/.pre-commit-config.yaml>configuration</a> pour <a href=https://pre-commit.com/ >pre-commit</a>, qui permet d'appliquer des scripts (des <a href=https://git-scm.com/book/fr/v2/Personnalisation-de-Git-Crochets-Git><em>git hooks</em></a>) de vérification et de nettoyage des fichiers avant qu'ils ne soit enregistrés dans le dépôt (d'où le nom).</p> <p>L'installation est optionnelle mais recommandée car l'outil garantit :</p> <ul> <li>un socle minimal de qualité des contenus et codes sources</li> <li>une cohérence d'ensemble entre les contributions</li> <li>qu'une fois poussée sur le dépôt central, la contribution passe <a href="https://github.com/geotribu/website/actions?query=workflow%3A%22Code+Rules+Checker%22">les checks exécutés par Github Action</a>.</li> </ul> <p>Installer <a href=https://pre-commit.com/ >pre-commit</a> :</p> <div class=highlight><pre><span></span><code><span class=c1># installer</span>
pre-commit install
</code></pre></div> <p>Une fois installés, les scripts s'exécuteront à chaque commit. Ne pas se laisser impressionner par les messages verbeux :wink: :</p> <div class=highlight><pre><span></span><code>&gt; git commit

<span class=o>[</span>WARNING<span class=o>]</span> Unstaged files detected.
<span class=o>[</span>INFO<span class=o>]</span> Stashing unstaged files to C:/Users/mPokora/.cache/pre-commit/patch1588143245.
Trim Trailing Whitespace.............................<span class=o>(</span>no files to check<span class=o>)</span>Skipped
Detect Private Key...................................<span class=o>(</span>no files to check<span class=o>)</span>Skipped
Fix End of Files.....................................<span class=o>(</span>no files to check<span class=o>)</span>Skipped
Check Yaml...........................................<span class=o>(</span>no files to check<span class=o>)</span>Skipped
Check <span class=k>for</span> added large files..........................<span class=o>(</span>no files to check<span class=o>)</span>Skipped
<span class=o>[</span>INFO<span class=o>]</span> Restored changes from C:/Users/mPokora/.cache/pre-commit/patch1588143245.
</code></pre></div> <p>Il est également possible de les exécuter manuellement :</p> <div class=highlight><pre><span></span><code>pre-commit run -a
</code></pre></div> <hr> <h2 id=servir-en-local>Servir en local<a class=headerlink href=#servir-en-local title="Permanent link">#</a></h2> <p>Puis de lancer la commande qui lance le site en local avec rechargement automatique :</p> <div class=highlight><pre><span></span><code><span class=c1># servir le site avec mkdocs</span>
mkdocs serve

<span class=c1># il existe aussi un mode où le rechargement automatique est plus rapide mais ne concerne que la page modifiée</span>
mkdocs serve -f mkdocs-minimal.yml --dirtyreload

<span class=c1># si besoin, il est évidemment possible de spécifier le port</span>
mkdocs serve -f mkdocs-minimal.yml --dirtyreload -a localhost:8085
</code></pre></div> <p>Par défaut, le site est accessible sur : <a href=http://localhost:8000>http://localhost:8000</a> mais il est évidemment possible de spécifier le port à utiliser : <code>mkdocs serve -a localhost:8085</code>.</p> <hr> <h3 id=docker>Docker<a class=headerlink href=#docker title="Permanent link">#</a></h3> <p>Il est possible de se passer de Python en utilisant Docker.</p> <div class=highlight><pre><span></span><code>docker-compose -f <span class=s2>&quot;docker-compose-mkdocs.dev.yml&quot;</span> up --build
</code></pre></div> <p>Le site est accessible sur : <a href=http://localhost:8000>http://localhost:8000</a></p> <hr> <h2 id=mettre-a-jour-son-depot-local>Mettre à jour son dépôt local<a class=headerlink href=#mettre-a-jour-son-depot-local title="Permanent link">#</a></h2> <p>Après qu'une branche ait été fusionnée (<em>merged</em>), elle est automatiquement supprimée par GitHub afin d'éviter de garder un trop grand nombre de branches. Il faut alors mettre à jour le dépôt local sur votre machine :</p> <div class=tabbed-set data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>Bash</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=c1># mettre le dépôt local en conformité avec le dépôt central (notamment en supprimant les branches locales déjà supprimées sur GitHub)</span>
git remote prune origin

<span class=c1># supprimer les branches qui ont été fusionnées - sauf master</span>
git branch --merged <span class=p>|</span> egrep -v <span class=s2>&quot;(^\*|master)&quot;</span> <span class=p>|</span> xargs git branch -d
</code></pre></div> </div> <input id=__tabbed_2_2 name=__tabbed_2 type=radio><label for=__tabbed_2_2>Powershell</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=c># mettre le dépôt local en conformité avec le dépôt central (notamment en supprimant les branches locales déjà supprimées sur GitHub)</span>
<span class=n>git</span> <span class=n>remote</span> <span class=n>prune</span> <span class=n>origin</span>

<span class=c># ouvre une fenêtre de sélection des branches à supprimer</span>
<span class=n>git</span> <span class=n>branch</span> <span class=p>-</span><span class=n>-format</span> <span class=s2>&quot;%(refname:short)&quot;</span> <span class=p>-</span><span class=n>-merged</span>  <span class=p>|</span> <span class=nb>Out-GridView</span> <span class=n>-PassThru</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=n>git</span> <span class=n>branch</span> <span class=n>-d</span> <span class=nv>$_</span> <span class=p>}</span>
</code></pre></div> </div> </div> </div> </div> </div> <hr> <footer class=container> <center><span class=copyleft>&copy;</span> Geotribu</center> <center>Documentation built with <a href=http://www.mkdocs.org>MkDocs</a> and <a href=http://kristopolous.github.io/BOOTSTRA.386>BOOTSTRA.386</a>.</center> </footer> <script src=../../../../../../theme/assets/javascripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/wa-mediabox@1.0.1/dist/wa-mediabox.min.js></script> <script src=https://unpkg.com/mermaid@8.6.4/dist/mermaid.min.js></script> <script src=../../../../../../search/main.js></script> </body> </html>